<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>MongoDB 学习笔记之CRUD - champ的个人博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="champ" />
  <meta name="description" content="启动一个 MongoDB 服务器容器 1 2 $ docker pull mongo:4 $ docker run --name mymongo -v /data/docker-db:/data/db -d mongo:4 启动 Mongo Express 容器 1 2 $ docker pull mongo-express $ docker run --link mymongo:mongo -p 8081:8081 -d mongo-express 在浏览器打开 http://localhost:8" />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.88.1" />


<link rel="canonical" href="https://blog.champ.design/post/2019/05/mongo-learn-note-1/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.19ae5a432863a072ec64433bb1020bd6d3401129f87d6f2ad5af3bcfd84168a1.css" integrity="sha256-Ga5aQyhjoHLsZEM7sQIL1tNAESn4fW8q1a87z9hBaKE=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="MongoDB 学习笔记之CRUD" />
<meta property="og:description" content="启动一个 MongoDB 服务器容器 1 2 $ docker pull mongo:4 $ docker run --name mymongo -v /data/docker-db:/data/db -d mongo:4 启动 Mongo Express 容器 1 2 $ docker pull mongo-express $ docker run --link mymongo:mongo -p 8081:8081 -d mongo-express 在浏览器打开 http://localhost:8" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.champ.design/post/2019/05/mongo-learn-note-1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-05-18T11:24:11+08:00" />
<meta property="article:modified_time" content="2019-05-18T11:24:11+08:00" />

<meta itemprop="name" content="MongoDB 学习笔记之CRUD">
<meta itemprop="description" content="启动一个 MongoDB 服务器容器 1 2 $ docker pull mongo:4 $ docker run --name mymongo -v /data/docker-db:/data/db -d mongo:4 启动 Mongo Express 容器 1 2 $ docker pull mongo-express $ docker run --link mymongo:mongo -p 8081:8081 -d mongo-express 在浏览器打开 http://localhost:8"><meta itemprop="datePublished" content="2019-05-18T11:24:11+08:00" />
<meta itemprop="dateModified" content="2019-05-18T11:24:11+08:00" />
<meta itemprop="wordCount" content="19806">
<meta itemprop="keywords" content="mongo," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MongoDB 学习笔记之CRUD"/>
<meta name="twitter:description" content="启动一个 MongoDB 服务器容器 1 2 $ docker pull mongo:4 $ docker run --name mymongo -v /data/docker-db:/data/db -d mongo:4 启动 Mongo Express 容器 1 2 $ docker pull mongo-express $ docker run --link mymongo:mongo -p 8081:8081 -d mongo-express 在浏览器打开 http://localhost:8"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">champ</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/categories/">Categories</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  
  




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      champ
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.champ.design/categories/">Categories</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">MongoDB 学习笔记之CRUD</h1>
      
      <div class="post-meta">
        <time datetime="2019-05-18" class="post-time">
          2019-05-18
        </time>
        
        <span class="more-meta"> 19806 words </span>
          <span class="more-meta"> 40 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#启动一个-mongodb-服务器容器">启动一个 MongoDB 服务器容器</a></li>
    <li><a href="#启动-mongo-express-容器">启动 Mongo Express 容器</a></li>
    <li><a href="#启动-mongo-shell">启动 Mongo shell</a></li>
    <li><a href="#文档的基本操作">文档的基本操作</a>
      <ul>
        <li><a href="#创建文档">创建文档</a></li>
        <li><a href="#对象主键">对象主键</a></li>
        <li><a href="#复合主键">复合主键</a></li>
        <li><a href="#读取文档">读取文档</a></li>
        <li><a href="#文档游标">文档游标</a></li>
        <li><a href="#游标函数">游标函数</a></li>
        <li><a href="#文档投射">文档投射</a></li>
      </ul>
    </li>
    <li><a href="#更新文档">更新文档</a>
      <ul>
        <li><a href="#更新整篇文档">更新整篇文档</a></li>
        <li><a href="#更新特定字段">更新特定字段</a></li>
        <li><a href="#数组更新操作符">数组更新操作符</a></li>
        <li><a href="#update-options">update options</a></li>
      </ul>
    </li>
    <li><a href="#删除文档">删除文档</a></li>
    <li><a href="#删除集合">删除集合</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="启动一个-mongodb-服务器容器">启动一个 MongoDB 服务器容器</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ docker pull mongo:4
$ docker run --name mymongo -v /data/docker-db:/data/db -d mongo:4
</code></pre></td></tr></table>
</div>
</div><h2 id="启动-mongo-express-容器">启动 Mongo Express 容器</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ docker pull mongo-express
$ docker run --link mymongo:mongo -p 8081:8081 -d mongo-express
</code></pre></td></tr></table>
</div>
</div><p>在浏览器打开 <code>http://localhost:8081</code>，mongo-expres 的界面如下:</p>
<p><img src="/images/mongo-express-shot@2x.png" alt=""></p>
<h2 id="启动-mongo-shell">启动 Mongo shell</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ docker <span class="nb">exec</span> -it mymongo mongo
</code></pre></td></tr></table>
</div>
</div><h2 id="文档的基本操作">文档的基本操作</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 查看所有数据库</span>
&gt; show dbs
admin   0.000GB
config  0.000GB
<span class="nb">local</span>   0.000GB

<span class="c1"># 切换到 test 数据库</span>
&gt; use <span class="nb">test</span>
switched to db <span class="nb">test</span>

<span class="c1"># 查看 test 数据库中的集合</span>
&gt; show collections
</code></pre></td></tr></table>
</div>
</div><h3 id="创建文档">创建文档</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 准备写入数据库的文档</span>
<span class="c1"># {</span>
<span class="c1">#   _id: &#34;account1&#34;,</span>
<span class="c1">#   name: &#34;alice&#34;,</span>
<span class="c1">#   balance: 100</span>
<span class="c1"># }</span>
<span class="c1"># 将文档写入 accounts 集合</span>
&gt; db.accounts.insertOne<span class="o">(</span>
... <span class="o">{</span>
...    _id: <span class="s2">&#34;account1&#34;</span>,
...    name: <span class="s2">&#34;alice&#34;</span>,
...    balance: <span class="m">100</span>
...  <span class="o">}</span>
...<span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;acknowledged&#34;</span>: true, <span class="s2">&#34;insertedId&#34;</span>: <span class="s2">&#34;account1&#34;</span> <span class="o">}</span>

<span class="c1"># 写入id重复的数据时</span>
&gt; db.accounts.insertOne<span class="o">(</span>
... <span class="o">{</span>
...    _id: <span class="s2">&#34;account1&#34;</span>,
...    name: <span class="s2">&#34;bob&#34;</span>,
...    balance: <span class="m">200</span>
...  <span class="o">}</span>
...<span class="o">)</span>
2019-05-18T13:37:29.722+0000 E QUERY    <span class="o">[</span>js<span class="o">]</span> WriteError: E11000 duplicate key error collection: test.accounts index: _id_ dup key: <span class="o">{</span> : <span class="s2">&#34;account1&#34;</span> <span class="o">}</span> :
WriteError<span class="o">({</span>
	<span class="s2">&#34;index&#34;</span> : 0,
	<span class="s2">&#34;code&#34;</span> : 11000,
	<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;E11000 duplicate key error collection: test.accounts index: _id_ dup key: { : \&#34;account1\&#34; }&#34;</span>,
	<span class="s2">&#34;op&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>,
		<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">200</span>
	<span class="o">}</span>
<span class="o">})</span>
WriteError@src/mongo/shell/bulk_api.js:461:48
Bulk/mergeBatchResults@src/mongo/shell/bulk_api.js:841:49
Bulk/executeBatch@src/mongo/shell/bulk_api.js:906:13
Bulk/this.execute@src/mongo/shell/bulk_api.js:1150:21
DBCollection.prototype.insertOne@src/mongo/shell/crud_api.js:252:9
@<span class="o">(</span>shell<span class="o">)</span>:1:1

<span class="c1"># 使用 try-catch 捕获错误</span>
&gt; try <span class="o">{</span>
...  db.accounts.insertOne<span class="o">(</span>
...    <span class="o">{</span>
...      _id: <span class="s2">&#34;account1&#34;</span>,
...      name: <span class="s2">&#34;bob&#34;</span>,
...      balance: <span class="m">200</span>
...    <span class="o">}</span>
...  <span class="o">)</span>
...<span class="o">}</span> catch <span class="o">(</span>e<span class="o">)</span> <span class="o">{</span>
...  print<span class="o">(</span>e<span class="o">)</span>    
...<span class="o">}</span>
WriteError<span class="o">({</span>
	<span class="s2">&#34;index&#34;</span> : 0,
	<span class="s2">&#34;code&#34;</span> : 11000,
	<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;E11000 duplicate key error collection: test.accounts index: _id_ dup key: { : \&#34;account1\&#34; }&#34;</span>,
	<span class="s2">&#34;op&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>,
		<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">200</span>
	<span class="o">}</span>
<span class="o">})</span>

<span class="c1"># 创建多个文档</span>
&gt; db.accounts.insertMany<span class="o">(</span> <span class="o">[</span>
... <span class="o">{</span>
...   name: <span class="s1">&#39;charlie&#39;</span>,
...   balance: <span class="m">500</span>
... <span class="o">}</span>,
... <span class="o">{</span>
...   name: <span class="s1">&#39;david&#39;</span>,
...   balance: <span class="m">200</span>
... <span class="o">}</span>
... <span class="o">]</span> <span class="o">)</span>
<span class="o">{</span>
	<span class="s2">&#34;acknowledged&#34;</span> : true,
	<span class="s2">&#34;insertedIds&#34;</span> : <span class="o">[</span>
		ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>,
		ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 顺序写出现错误时</span>
&gt; try <span class="o">{</span>
... db.accounts.insertMany<span class="o">(</span> <span class="o">[</span>
...   <span class="o">{</span>
...     _id: <span class="s1">&#39;account1&#39;</span>,
...     name: <span class="s1">&#39;edwrad&#39;</span>,
...     balance: <span class="m">700</span>
...   <span class="o">}</span>,
...   <span class="o">{</span>
...     name: <span class="s1">&#39;fred&#39;</span>,
...     balance: <span class="m">20</span>
...   <span class="o">}</span>
... <span class="o">]</span> <span class="o">)</span>
... <span class="o">}</span> catch<span class="o">(</span>e<span class="o">)</span> <span class="o">{</span>
...   print<span class="o">(</span>e<span class="o">)</span>
... <span class="o">}</span>
BulkWriteError<span class="o">({</span>
	<span class="s2">&#34;writeErrors&#34;</span> : <span class="o">[</span>
		<span class="o">{</span>
			<span class="s2">&#34;index&#34;</span> : 0,
			<span class="s2">&#34;code&#34;</span> : 11000,
			<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;E11000 duplicate key error collection: test.accounts index: _id_ dup key: { : \&#34;account1\&#34; }&#34;</span>,
			<span class="s2">&#34;op&#34;</span> : <span class="o">{</span>
				<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>,
				<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;edwrad&#34;</span>,
				<span class="s2">&#34;balance&#34;</span> : <span class="m">700</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">]</span>,
	<span class="s2">&#34;writeConcernErrors&#34;</span> : <span class="o">[</span> <span class="o">]</span>,
	<span class="s2">&#34;nInserted&#34;</span> : 0, <span class="c1">#注意这里，插入条数为0</span>
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;nRemoved&#34;</span> : 0,
	<span class="s2">&#34;upserted&#34;</span> : <span class="o">[</span> <span class="o">]</span>
<span class="o">})</span>

<span class="c1"># 乱序写出现错误时</span>
&gt; try <span class="o">{</span>
... db.accounts.insertMany<span class="o">(</span> <span class="o">[</span>
...   <span class="o">{</span>
...     _id: <span class="s1">&#39;account1&#39;</span>,
...     name: <span class="s1">&#39;edwrad&#39;</span>,
...     balance: <span class="m">700</span>
...   <span class="o">}</span>,
...   <span class="o">{</span>
...     name: <span class="s1">&#39;fred&#39;</span>,
...     balance: <span class="m">20</span>
...   <span class="o">}</span>
... <span class="o">]</span>, <span class="o">{</span> ordered: <span class="nb">false</span> <span class="o">}</span> <span class="o">)</span>
... <span class="o">}</span> catch<span class="o">(</span>e<span class="o">)</span> <span class="o">{</span>
...   print<span class="o">(</span>e<span class="o">)</span>
... <span class="o">}</span>
BulkWriteError<span class="o">({</span>
	<span class="s2">&#34;writeErrors&#34;</span> : <span class="o">[</span>
		<span class="o">{</span>
			<span class="s2">&#34;index&#34;</span> : 0,
			<span class="s2">&#34;code&#34;</span> : 11000,
			<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;E11000 duplicate key error collection: test.accounts index: _id_ dup key: { : \&#34;account1\&#34; }&#34;</span>,
			<span class="s2">&#34;op&#34;</span> : <span class="o">{</span>
				<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>,
				<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;edwrad&#34;</span>,
				<span class="s2">&#34;balance&#34;</span> : <span class="m">700</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">]</span>,
	<span class="s2">&#34;writeConcernErrors&#34;</span> : <span class="o">[</span> <span class="o">]</span>,
	<span class="s2">&#34;nInserted&#34;</span> : 1, <span class="c1">#成功插入了1条</span>
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;nRemoved&#34;</span> : 0,
	<span class="s2">&#34;upserted&#34;</span> : <span class="o">[</span> <span class="o">]</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>总结<!-- raw HTML omitted -->
<code>db.collection.insertMany()</code> 处理错误的方式:<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="mi">_</span><span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;edwrad&#34;</span><span class="p">,</span>        <span class="o">-------&gt;</span> <span class="nx">错误的文档</span>
    <span class="nx">balance</span><span class="o">:</span> <span class="mi">700</span>
<span class="p">}</span>
<span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;fred&#34;</span><span class="p">,</span>          <span class="o">-------&gt;</span> <span class="nx">正确的文档</span>
    <span class="nx">balance</span><span class="o">:</span> <span class="mi">20</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在顺序写入时，一旦遇到错误，操作便会退出，剩余的文档无论正确与否，都不会被写入<!-- raw HTML omitted -->
所以，上面这两个文档都不会被写入到数据库<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
在乱序写入时，即使某些文档造成了错误，剩余的正确的文档仍然会被写入
所以，第二篇文档会被正常写入数据库<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># insert 命令</span>
<span class="c1"># 创建单个或多个文档</span>
&gt; db.accounts.insert<span class="o">(</span>
... <span class="o">{</span>
...   name: <span class="s1">&#39;george&#39;</span>,
...   balance: <span class="m">1000</span>
... <span class="o">}</span>
... <span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nInserted&#34;</span> : <span class="m">1</span> <span class="o">})</span>

&gt; db.accounts.insert<span class="o">(</span> <span class="o">[</span>
...  <span class="o">{</span>
...    name: <span class="s1">&#39;abc&#39;</span>,
...    balance: <span class="m">200</span>
...  <span class="o">}</span>,
...  <span class="o">{</span>
...    name: <span class="s1">&#39;xyz&#39;</span>,
...    balance: <span class="m">200</span>
...  <span class="o">}</span>
<span class="o">]</span> <span class="o">)</span>
BulkWriteResult<span class="o">({</span>
    <span class="s2">&#34;writeErrors&#34;</span>: <span class="o">[</span> <span class="o">]</span>,
    <span class="s2">&#34;writeConcernErrors&#34;</span>: <span class="o">[</span> <span class="o">]</span>,
    <span class="s2">&#34;nInserted&#34;</span>: 2,
    <span class="s2">&#34;nUpserted&#34;</span>: 0,
    <span class="s2">&#34;nMatched&#34;</span>: 0,
    <span class="s2">&#34;nModified&#34;</span>: 0,
    <span class="s2">&#34;nRemoved&#34;</span>: 0,
    <span class="s2">&#34;upserted&#34;</span>: <span class="o">[</span> <span class="o">]</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># save 创建单一文档</span>
&gt; db.accounts.save<span class="o">(</span>
    <span class="o">{</span>
        name: <span class="s1">&#39;&#39;</span>,
        balance: <span class="m">200</span>
    <span class="o">}</span>,
    <span class="o">{</span>
        writeConcern: &lt;document&gt;
    <span class="o">}</span>
<span class="o">)</span>
<span class="c1"># save 会调用 insert 创建文档，所以 save 的返回类型和 insert 相同</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="对象主键">对象主键</h3>
<p>默认的对象主键 objectId</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 生成objectId主键</span>
&gt; ObjectId<span class="o">()</span>
ObjectId<span class="o">(</span><span class="s2">&#34;5ce0ec0672e77e7cb392a90b&#34;</span><span class="o">)</span>

<span class="c1"># 提前 ObjectId 的创建时间</span>
&gt; ObjectId<span class="o">(</span><span class="s2">&#34;5ce0ec0672e77e7cb392a90b&#34;</span><span class="o">)</span>.getTimestamp<span class="o">()</span>
ISODate<span class="o">(</span><span class="s2">&#34;2019-05-19T05:39:18Z&#34;</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="复合主键">复合主键</h3>
<p>可以使用文档作为文档的主键</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.insert<span class="o">(</span>
    <span class="o">{</span>
        _id: <span class="o">{</span> accountNo: <span class="s2">&#34;001&#34;</span>, type: <span class="s2">&#34;savings&#34;</span> <span class="o">}</span>,
        name: <span class="s2">&#34;irene&#34;</span>,
        balance: <span class="m">80</span>
    <span class="o">}</span>
<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="读取文档">读取文档</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># find 支持匹配查询和投射</span>
db.&lt;collection&gt;.find<span class="o">(</span>&lt;query&gt;, &lt;projection&gt;<span class="o">)</span>
&lt;query&gt;定义了搜索条件
&lt;projection&gt;定义了投射，可以只返回结果文档中的部分字段

<span class="c1"># 读取全部文档</span>
<span class="c1"># 既不筛选，也不投射</span>
&gt; db.accounts.find<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 格式化结果</span>
&gt; db.accounts.find<span class="o">()</span>.pretty<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">50</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">500</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">200</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">20</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">100</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>,
		<span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span>
	<span class="o">}</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">200</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>,
		<span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span>
	<span class="o">}</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">100</span>
<span class="o">}</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>,
		<span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span>
	<span class="o">}</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : <span class="m">500</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="匹配查询">匹配查询</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 匹配查询</span>
语法: <span class="o">{</span> &lt;field&gt;: &lt;value&gt;, ... <span class="o">}</span>

<span class="c1"># 读取 alice 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

<span class="c1"># 读取 alice 的余额为100元的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="s2">&#34;alice&#34;</span>, balance: <span class="m">100</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

<span class="c1"># 读取 alice 的余额为200元的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="s2">&#34;alice&#34;</span>, balance: <span class="m">200</span> <span class="o">}</span> <span class="o">)</span>
不存在

<span class="c1"># 读取银行账户类型为 savings 的文档 (复合主键)</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> <span class="s2">&#34;_id.type&#34;</span>: <span class="s2">&#34;savings&#34;</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="比较操作符">比较操作符</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 比较操作符</span>

<span class="nv">$eq</span>     equal
<span class="nv">$ne</span>     not equal
<span class="nv">$gt</span>     great than
<span class="nv">$gte</span>    great than or equal
<span class="nv">$lt</span>     less than
<span class="nv">$lte</span>    less than or equal

语法: <span class="o">{</span> &lt;field&gt;: <span class="o">{</span> $&lt;operator&gt;: &lt;value&gt; <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取 alice 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$eq</span>: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="c1"># 与 db.accounts.find( { name: &#34;alice&#34; } ) 的查询效果相同</span>

<span class="c1"># 读取不属于 alice 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$ne</span>: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 读取所有余额不等于100的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$ne</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 读取余额大于200的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">200</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>


<span class="nv">$in</span>     匹配字段值与任一查询值相等的文档
<span class="nv">$nin</span>    匹配字段值与任何查询值都不相等的文档

语法: <span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$in</span>: <span class="o">[</span> &lt;value1&gt;, &lt;value2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取 alice 和 charlie 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$in</span>: <span class="o">[</span> <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;charlie&#34;</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 读取除了 alice 和 charlie 以外的其他用户的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$nin</span>: <span class="o">[</span> <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;charlie&#34;</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>$ne</code>会筛选出并不包含查询字段的文档<!-- raw HTML omitted -->
比如，读取银行账户类型不是 <code>savings</code> 的文档: <!-- raw HTML omitted -->
<code>db.accounts.find( { &quot;_id.type&quot;: { $ne: &quot;savings&quot; } } )</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;bob&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;david&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;fred&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">1000</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;alipay&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;003&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>可以看到，结果中有很多文档并没有包含 <code>_id.type</code> 这个字段<!-- raw HTML omitted -->
可以配合下面的 <code>$exists</code> 操作符一块使用<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
与 <code>$ne</code> 类似，<code>$nin</code> 也会筛选出并不包含查询字段的文档<!-- raw HTML omitted -->
比如，读取账户类型不是 <code>savings</code> 的银行账户文档: <!-- raw HTML omitted -->
<code>db.accounts.find( { &quot;_id.type&quot;: { $nin: [ &quot;savings&quot; ] } } )</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;bob&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;david&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;fred&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">1000</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;alipay&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;003&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>可以看到，结果中有很多文档并没有包含 <code>_id.type</code> 这个字段<!-- raw HTML omitted -->
可以配合下面的 <code>$exists</code> 操作符一块使用<!-- raw HTML omitted --></p>
</blockquote>
<h4 id="逻辑操作符">逻辑操作符</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 逻辑操作符查询</span>

<span class="nv">$not</span>    匹配筛选条件不成立的文档
<span class="nv">$and</span>    匹配多个筛选条件全部成立的文档
<span class="nv">$or</span>     匹配至少一个筛选条件成立的文档
<span class="nv">$nor</span>    匹配多个筛选条件全部不成立的文档


<span class="nv">$not</span> 语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$not</span>: <span class="o">{</span> &lt;operator-expression&gt; <span class="o">}</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取余额不小于200的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$not</span>: <span class="o">{</span> <span class="nv">$lt</span>: <span class="m">200</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>


<span class="nv">$and</span> 语法:
<span class="o">{</span> <span class="nv">$and</span>: <span class="o">[</span> <span class="o">{</span> &lt;expression1&gt; <span class="o">}</span>, <span class="o">{</span> &lt;expression2&gt; <span class="o">}</span>, ... <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取余额大于100并且用户姓名排在 fred 之后的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> <span class="nv">$and</span>: <span class="o">[</span>
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;fred&#34;</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">]</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 当筛选条件应用在不同字段上时，可以省略 $and 操作符</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">100</span> <span class="o">}</span>, name: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;fred&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
和上面的查询效果相同

<span class="c1"># 当筛选条件应用在同一个字段上时，也可以简化命令</span>
<span class="c1"># 读取余额大于100并且小于500的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> <span class="nv">$and</span>: <span class="o">[</span>
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$lt</span>: <span class="m">500</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">]</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>

&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: 100, <span class="nv">$lt</span>: <span class="m">500</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>


<span class="nv">$or</span> 语法:<span class="o">(</span>与 <span class="nv">$and</span> 类似<span class="o">)</span>
<span class="o">{</span> <span class="nv">$or</span>: <span class="o">[</span> <span class="o">{</span> &lt;expression1&gt; <span class="o">}</span>, <span class="o">{</span> &lt;expression2&gt; <span class="o">}</span>, ... <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取属于 alice 或者 charlie 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> <span class="nv">$or</span>: <span class="o">[</span> 
    <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$eq</span>: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$eq</span>: <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">]</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 当所有筛选条件使用的都是 $eq 操作符时，$or 和 $in 的效果是相同的</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$in</span>: <span class="o">[</span> <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;charlie&#34;</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

<span class="c1"># 读取余额小于100或者大于500的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> <span class="nv">$or</span>: <span class="o">[</span>
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">500</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">]</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>


<span class="nv">$nor</span> 语法:<span class="o">(</span>与 <span class="nv">$and</span> 类似<span class="o">)</span>
<span class="o">{</span> <span class="nv">$nor</span>: <span class="o">[</span> <span class="o">{</span> &lt;expression1&gt; <span class="o">}</span>, <span class="o">{</span> &lt;expression2&gt; <span class="o">}</span>, ... <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取不属于 alice 和 charlie 且余额不小于100的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> <span class="nv">$nor</span>: <span class="o">[</span>
    <span class="o">{</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">]</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>$not</code> 和 <code>$nor</code> 也会筛选出并不包含查询字段的文档<!-- raw HTML omitted -->
可以配合下面的 <code>$exists</code> 操作符一块使用<!-- raw HTML omitted --></p>
</blockquote>
<h4 id="字段操作符">字段操作符</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 字段操作符</span>

<span class="nv">$exists</span>     匹配包含查询字段的文档
<span class="nv">$type</span>       匹配字段类型符合查询值的文档


<span class="nv">$exists</span> 语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$exists</span>: &lt;boolean&gt; <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取包含账户类型字段的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> <span class="s2">&#34;_id.type&#34;</span>: <span class="o">{</span> <span class="nv">$exists</span>: <span class="nb">true</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> <span class="s2">&#34;_id.type&#34;</span>: <span class="o">{</span> <span class="nv">$ne</span>: <span class="s2">&#34;alipay&#34;</span>, <span class="nv">$exists</span>: <span class="nb">true</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>


<span class="nv">$type</span> 语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$type</span>: &lt;BSON type&gt; <span class="o">}</span> <span class="o">}</span>
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$type</span>: <span class="o">[</span> &lt;BSON type1&gt;, &lt;BSON type2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取文档主键是字符串的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> _id: <span class="o">{</span> <span class="nv">$type</span>: <span class="s2">&#34;string&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

<span class="c1"># 读取文档主键是对象主键或者复合主键的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> _id: <span class="o">{</span> <span class="nv">$type</span>: <span class="o">[</span><span class="s2">&#34;objectId&#34;</span>, <span class="s2">&#34;object&#34;</span><span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

<span class="c1"># 读取用户姓名是 null 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$type</span>: <span class="s2">&#34;null&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>

除了使用BSON类型名称作为 <span class="nv">$type</span> 操作符的参数，我们还可以使用类型序号。比如
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> _id: <span class="o">{</span> <span class="nv">$type</span>: <span class="m">2</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="数组操作符">数组操作符</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 数组操作符</span>

<span class="nv">$all</span>        匹配数组字段中包含所有查询值的文档
<span class="nv">$elemMatch</span>  匹配数组字段中至少存在一个值满足筛选条件的文档


<span class="nv">$all</span> 语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$all</span>: <span class="o">[</span> &lt;value1&gt;, &lt;value2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 首先，为了练习这个操作符，我们先创建一些包含数组和嵌套数组的文档</span>
&gt; db.accounts.insert<span class="o">([</span>
    <span class="o">{</span>
        name: <span class="s2">&#34;jack&#34;</span>,
        balance: 2000,
        contact: <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span>
    <span class="o">}</span>,
    <span class="o">{</span>
        name: <span class="s2">&#34;karen&#34;</span>,
        balance: 2500,
        contact: <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span>
    <span class="o">}</span>
<span class="o">])</span>
BulkWriteResult<span class="o">({</span>
	<span class="s2">&#34;writeErrors&#34;</span> : <span class="o">[</span> <span class="o">]</span>,
	<span class="s2">&#34;writeConcernErrors&#34;</span> : <span class="o">[</span> <span class="o">]</span>,
	<span class="s2">&#34;nInserted&#34;</span> : 2,
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;nRemoved&#34;</span> : 0,
	<span class="s2">&#34;upserted&#34;</span> : <span class="o">[</span> <span class="o">]</span>
<span class="o">})</span>

<span class="c1"># 读取联系地址位于中国北京的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> contact: <span class="o">{</span> <span class="nv">$all</span>: <span class="o">[</span> <span class="s2">&#34;China&#34;</span>, <span class="s2">&#34;Beijing&#34;</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2500, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取联系电话包含 22222222 和 33333333 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> contact: <span class="o">{</span> <span class="nv">$all</span>: <span class="o">[</span> <span class="o">[</span><span class="s2">&#34;22222222&#34;</span>,<span class="s2">&#34;33333333&#34;</span><span class="o">]</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2500, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> contact: <span class="o">{</span> <span class="nv">$all</span>: <span class="o">[</span> <span class="o">[</span><span class="s2">&#34;33333333&#34;</span>,<span class="s2">&#34;22222222&#34;</span><span class="o">]</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
不匹配任何文档


<span class="nv">$elemMatch</span> 语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> &lt;query1&gt;, &lt;query2&gt;, ... <span class="o">}</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 读取联系电话范围在 10000000 至 20000000 之间的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> contact: <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;10000000&#34;</span>, <span class="nv">$lt</span>: <span class="s2">&#34;20000000&#34;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2000, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取包含一个在 10000000 至 20000000 之间，和一个在 20000000 至 30000000 之间的联系电话的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span>
    contact: <span class="o">{</span> <span class="nv">$all</span>: <span class="o">[</span>
        <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;10000000&#34;</span>, <span class="nv">$lt</span>: <span class="s2">&#34;20000000&#34;</span> <span class="o">}</span> <span class="o">}</span>,
        <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;20000000&#34;</span>, <span class="nv">$lt</span>: <span class="s2">&#34;30000000&#34;</span> <span class="o">}</span> <span class="o">}</span>
    <span class="o">]</span> <span class="o">}</span>
<span class="o">}</span> <span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="运算操作符">运算操作符</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 筛选文档</span>
<span class="c1"># 运算操作符</span>

<span class="nv">$regex</span>      匹配满足正则表达式的文档

语法:
<span class="o">{</span> &lt;field&gt;: <span class="o">{</span> <span class="nv">$regex</span>: /pattern/, <span class="nv">$options</span>: <span class="s2">&#34;&lt;options&gt;&#34;</span> <span class="o">}</span> <span class="o">}</span>  <span class="c1"># 大部分场景使用该语法</span>
<span class="o">{</span> &lt;field&gt;: /pattern/&lt;options&gt; <span class="o">}</span>        <span class="c1"># 特定场景使用该语法</span>

兼容 PCRE v8.41 正则表达式库
在与 <span class="nv">$in</span> 操作符配合使用时，只能使用 /pattern/&lt;options&gt; 语法

<span class="c1"># 读取用户姓名以 c 或者 j 开头的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$in</span>: <span class="o">[</span> /^c/, /^j/ <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2000, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 读取用户姓名包含 LIE (不区分大小写)的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="o">{</span> <span class="nv">$regex</span>: /LIE/, <span class="nv">$options</span>: <span class="s1">&#39;i&#39;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>

&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: /LIE/i <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="文档游标">文档游标</h3>
<p><code>db.collection.find()</code> 返回的是一个文档集合游标</p>
<p>在<strong>不迭代</strong>游标的情况下，只列出前20个文档:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">myCursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
<span class="o">&gt;</span> <span class="nx">myCursor</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;bob&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;david&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;fred&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">1000</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;001&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;john&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;alipay&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;003&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;jack&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&#34;contact&#34;</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&#34;11111111&#34;</span><span class="p">,</span> <span class="s2">&#34;Alabama&#34;</span><span class="p">,</span> <span class="s2">&#34;US&#34;</span> <span class="p">]</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;karen&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">2500</span><span class="p">,</span> <span class="s2">&#34;contact&#34;</span> <span class="o">:</span> <span class="p">[</span> <span class="p">[</span> <span class="s2">&#34;22222222&#34;</span><span class="p">,</span> <span class="s2">&#34;33333333&#34;</span> <span class="p">],</span> <span class="s2">&#34;Beijing&#34;</span><span class="p">,</span> <span class="s2">&#34;China&#34;</span> <span class="p">]</span> <span class="p">}</span>
<span class="c1">// 这里由于我们的文档总数不足20，所以看不出效果
</span></code></pre></td></tr></table>
</div>
</div><p>我们也可以使用游标下标直接访问文档集合中的某一个文档，<strong>下标从0开始</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">myCursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
<span class="o">&gt;</span> <span class="nx">myCursor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">{</span>
	<span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="p">),</span>
	<span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;bob&#34;</span><span class="p">,</span>
	<span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">50</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，遍历完游标中所有的文档之后，或者在10分钟之后，游标便会自动关闭</p>
<p>我们可以使用 <code>noCursorTimeout()</code> 函数来保持游标一直有效</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">myCursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">noCursorTimeout</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><p>在这之后，如果我们遍历完了游标，游标会自动关闭。但是如果在不遍历游标的情况下，需要主动关闭游标</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">myCursor</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="游标函数">游标函数</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">cursor</span><span class="p">.</span><span class="nx">hasNext</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">next</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">forEach</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">limit</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">skip</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">count</span><span class="p">()</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="hasnext-和-next-函数">hasNext 和 next 函数</h4>
<blockquote>
<p>hasNext 和 next 用于遍历游标</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">myCursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">});</span>
<span class="o">&gt;</span> <span class="k">while</span><span class="p">(</span> <span class="nx">myCursor</span><span class="p">.</span><span class="nx">hasNext</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">printjson</span><span class="p">(</span><span class="nx">myCursor</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>
<span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span>
	<span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span>
	<span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span>
	<span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span>
<span class="p">}</span>
<span class="p">{</span>
	<span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span>
		<span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span>
		<span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span>
	<span class="p">},</span>
	<span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span>
	<span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="foreach-函数">forEach 函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="kd">var</span> <span class="nx">myCursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">});</span>
<span class="o">&gt;</span> <span class="nx">myCursor</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">printjson</span><span class="p">);</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span>
	<span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span>
	<span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span>
	<span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span>
<span class="p">}</span>
<span class="p">{</span>
	<span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span>
		<span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span>
		<span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span>
	<span class="p">},</span>
	<span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span>
	<span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="limit-和-skip-函数">limit 和 skip 函数</h4>
<blockquote>
<p>这两个函数通常用于分页</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">cursor</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nx">cursor</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">offset</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>

<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>问题: <!-- raw HTML omitted -->
如果使用 <code>cursor.limit(0)</code> 会返回什么结果呢？<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
答案: <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>不对游标进行任何限制，与 <code>limit()</code> 以及不进行调用效果相同。<!-- raw HTML omitted -->
也就是说，默认返回前20个文档？</p>
</blockquote>
<h4 id="count-函数">count 函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">cursor</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">applySkipLimit</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>默认情况下，<code>&lt;applySkipLimit&gt;</code> 为 <code>false</code>，即 <code>cursor.count()</code> 不会考虑 <code>cursor.skip()</code> 和 <code>cursor.limit()</code> 的效果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">})</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;002&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>

<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">3</span>

<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">count</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="mi">1</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 在不提供筛选条件时，cursor.count() 会从集合的元数据 Metadata 中取得结果，而不会遍历集合</span>
&gt; db.accounts.find<span class="o">()</span>.count<span class="o">()</span>
<span class="m">22</span>
&gt; db.accounts.count<span class="o">()</span>
<span class="m">22</span>

<span class="c1"># 当数据库分布式结构较为复杂时，元数据中的文档数量可能不准确</span>
<span class="c1"># 在这种情况下，应该避免使用不提供筛选条件的 cursor.count() 函数，而使用聚合管道来计算文档数量</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="sort-函数">sort 函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">cursor</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>这里的 <code>&lt;document&gt;</code> 定义了排序的要求，<code>{ field: ordering}</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">1表示递增排序
-1表示递减排序

<span class="c1"># 按照余额从大到小，用户姓名按字母排序的方式排列银行账户文档</span>
&gt; db.accounts.find<span class="o">()</span>.sort<span class="o">(</span> <span class="o">{</span> balance: -1, name: <span class="m">1</span> <span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2500, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2000, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">1000</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225972e77e7cb392a90f&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225b72e77e7cb392a910&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225c72e77e7cb392a911&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225d72e77e7cb392a912&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225d72e77e7cb392a913&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225e72e77e7cb392a914&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1226b72e77e7cb392a915&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1226b72e77e7cb392a916&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1226c72e77e7cb392a917&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1226d72e77e7cb392a918&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
Type <span class="s2">&#34;it&#34;</span> <span class="k">for</span> more
&gt; it
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>

<span class="c1"># 读取余额最大的银行账户文档</span>
&gt; db.accounts.find<span class="o">()</span>.sort<span class="o">({</span> balance: -1 <span class="o">})</span>.limit<span class="o">(</span>1<span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 2500, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>cursor.skip()</code>, <code>cursor.limit()</code>, <code>cursor.sort()</code>的执行顺序<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
原则一: <code>cursor.skip()</code>永远在<code>cursor.limit()</code>之前执行<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>从书写顺序看，是先执行了<code>limit(5)</code>拿到5条数据，然后执行<code>skip(3)</code>跳过3条数据，结果就剩2条数据了。<!-- raw HTML omitted -->
但是执行结果如下<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;david&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;fred&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;george&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">1000</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="p">),</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;champ&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&#34;_id&#34;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;savings&#34;</span><span class="p">,</span> <span class="s2">&#34;accountId&#34;</span> <span class="o">:</span> <span class="s2">&#34;001&#34;</span> <span class="p">},</span> <span class="s2">&#34;name&#34;</span> <span class="o">:</span> <span class="s2">&#34;john&#34;</span><span class="p">,</span> <span class="s2">&#34;balance&#34;</span> <span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实际执行顺序是，<code>find()</code>拿到所有文档数量，<code>skip(3)</code>跳过前3条，然后<code>limit(5)</code>取出接下来的5条数据<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
原则二: <code>cursor.sort()</code>永远在<code>cursor.skip()</code>和<code>cursor.limit()</code>之前执行<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">balance</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>先执行<code>sort({ balance: -1 })</code>按照余额降序排序，然后执行<code>skip(3)</code>跳过前3条，最后执行<code>limit(5)</code>取出接下来的5条数据<!-- raw HTML omitted -->
与 <code>db.accounts.find().limit(5).skip(3).sort({ balance: -1 })</code>的结果相同，不管书写顺序如何，执行顺序永远是:<!-- raw HTML omitted -->
<code>sort()</code> &gt; <code>skip()</code> &gt; <code>limit()</code><!-- raw HTML omitted --></p>
</blockquote>
<h3 id="文档投射">文档投射</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">projection</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>不使用投射时，<code>db.collection.find()</code>返回符合筛选条件的完整文档，而使用投射可以有选择性的返回文档中的部分字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">projection: <span class="o">{</span> field: inclusion <span class="o">}</span>
<span class="m">1</span> 表示返回该字段
<span class="m">0</span> 表示不返回该字段

<span class="c1"># 只返回银行账户文档中的用户姓名</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> name: <span class="m">1</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>

<span class="c1"># 只返回银行账户文档中的用户姓名(不包含文档主键)</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> name: 1, _id: <span class="m">0</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>

<span class="c1"># 不返回银行账户文档中的用户姓名(也不返回文档主键)</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> name: 0, _id: <span class="m">0</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : <span class="m">500</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : 2000, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;balance&#34;</span> : 2500, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>projection</code>参数不能混用包含与不包含这两种投射操作，文档主键除外<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">_</span><span class="nx">id</span><span class="o">:</span> <span class="mi">0</span> <span class="p">})</span>
<span class="nb">Error</span><span class="o">:</span> <span class="nx">error</span><span class="o">:</span> <span class="p">{</span>
	<span class="s2">&#34;ok&#34;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="s2">&#34;errmsg&#34;</span> <span class="o">:</span> <span class="s2">&#34;Projection cannot have a mix of inclusion and exclusion.&#34;</span><span class="p">,</span>
	<span class="s2">&#34;code&#34;</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="s2">&#34;codeName&#34;</span> <span class="o">:</span> <span class="s2">&#34;BadValue&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="在数组字段上使用投射">在数组字段上使用投射</h4>
<p><code>$slice</code>操作符可以返回数组字段中的部分元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 不使用 slice 操作符</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> _id: 0, name: 1, contact: <span class="m">1</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span>, <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span>, <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 返回 contact 字段的第一个元素</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> _id: 0, name: 1, contact: <span class="o">{</span> <span class="nv">$slice</span>: <span class="m">1</span> <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;11111111&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="o">[</span> <span class="s2">&#34;22222222&#34;</span>, <span class="s2">&#34;33333333&#34;</span> <span class="o">]</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 返回 contact 字段最后一个元素</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> _id: 0, name: 1, contact: <span class="o">{</span> <span class="nv">$slice</span>: -1 <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 返回 contact 字段的最后两个元素</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> _id: 0, name: 1, contact: <span class="o">{</span> <span class="nv">$slice</span>: -2 <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 对 contact 字段先执行一个 skip(1) 操作，然后执行 limit(2) 操作</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span> _id: 0, name: 1, contact: <span class="o">{</span> <span class="nv">$slice</span>: <span class="o">[</span>1, 2<span class="o">]</span> <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;Alabama&#34;</span>, <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;Beijing&#34;</span>, <span class="s2">&#34;China&#34;</span> <span class="o">]</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>$elemMatch</code>和<code>$</code>操作符可以返回数组字段中，满足筛选条件的第一个元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 返回 contact 中大于 Alabama 的第一个元素</span>
&gt; db.accounts.find<span class="o">({}</span>, <span class="o">{</span>
    _id: 0,
    name: 1,
    contact: <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;Alabama&#34;</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;US&#34;</span> <span class="o">]</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;contact&#34;</span> : <span class="o">[</span> <span class="s2">&#34;Beijing&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1"># 使用&lt;query&gt;参数中 contact 的筛选条件作为 projection 中 contact 的投射操作</span>
<span class="c1"># 是上面 $elemMatch 的简写形式</span>
&gt; db.accounts.find<span class="o">({</span>
    contact: <span class="o">{</span> <span class="nv">$gt</span>: <span class="s2">&#34;Alabama&#34;</span> <span class="o">}</span>
<span class="o">}</span>, <span class="o">{</span>
    _id: 0,
    name: 1,
    <span class="s2">&#34;contact.</span>$<span class="s2">&#34;</span>: <span class="m">1</span>  <span class="c1"># contact: { $elemMatch: { $gt: &#34;Alabama&#34; } } 的简写形式？</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>？疑问<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="nx">contact</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="s2">&#34;Alabama&#34;</span> <span class="p">}</span> <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>是查询出<code>contact</code>字段大于字符串<code>Alabama</code>的文档，但是<code>contact</code>是数组类型，数组是如何与字符串进行比较操作的？</p>
</blockquote>
<h2 id="更新文档">更新文档</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法: db.&lt;collection&gt;.update<span class="o">(</span>&lt;query&gt;, &lt;update&gt;, &lt;options&gt;<span class="o">)</span>

<span class="c1"># &lt;query&gt; 文档定义了更新文档时筛选文档的条件，也就是说，要更新哪些文档</span>
<span class="c1"># 与 db.collection.find() 中的 query 相同</span>

<span class="c1"># &lt;update&gt; 文档提供了更新的内容，也就是说，要进行什么样的更新</span>

<span class="c1"># &lt;options&gt; 文档声明了一些应用于更新操作的选项和参数</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="更新整篇文档">更新整篇文档</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 如果 &lt;update&gt; 文档不包含任何更新操作符，则会更新整个文档。</span>
<span class="c1"># 执行的是替换操作</span>

<span class="c1"># 检查 alice 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>

<span class="c1"># 将 alice 的账户余额更改为123</span>
&gt; db.accounts.update<span class="o">({</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">}</span>, <span class="o">{</span> name: <span class="s2">&#34;alice&#34;</span>, balance: <span class="m">123</span> <span class="o">})</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 检查 alice 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">123</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
第一，文档主键 <code>_id</code> <strong>在任何情况下</strong>都是不可以更改的<!-- raw HTML omitted -->
如果我们在 <code>&lt;update&gt;</code>文档中包含<code>_id</code>字段，则<code>_id</code>值一定要和被更新文档的<code>_id</code>值保持一致<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;alice&#34;</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">_</span><span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;account1&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">100</span> <span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span> <span class="s2">&#34;nMatched&#34;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;nUpserted&#34;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;nModified&#34;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果<code>&lt;update&gt;</code>文档中包含的<code>_id</code>字段和被更新的文档<code>_id</code>值不一致，则会更新失败<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;alice&#34;</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">_</span><span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;account2&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="nx">balance</span><span class="o">:</span> <span class="mi">123</span> <span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span>
	<span class="s2">&#34;nMatched&#34;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="s2">&#34;nUpserted&#34;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="s2">&#34;nModified&#34;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="s2">&#34;writeError&#34;</span> <span class="o">:</span> <span class="p">{</span>
		<span class="s2">&#34;code&#34;</span> <span class="o">:</span> <span class="mi">66</span><span class="p">,</span>
		<span class="s2">&#34;errmsg&#34;</span> <span class="o">:</span> <span class="s2">&#34;After applying the update, the (immutable) field &#39;_id&#39; was found to have been altered to _id: \&#34;account2\&#34;&#34;</span>
	<span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>第二，在使用<code>&lt;update&gt;</code>文档替换整篇被更新文档时，只有<strong>第一篇</strong>符合<code>&lt;query&gt;</code>筛选条件的文档才会被更新</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 查看账户余额在0到100之间的账户文档</span>
&gt; db.accounts.find<span class="o">({</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: 0, <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bob&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">50</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>

<span class="c1"># 更新账户余额在0到100之间的账户文档</span>
&gt; db.accounts.update<span class="o">({</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: 0, <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>, <span class="o">{</span> name: <span class="s2">&#34;bill&#34;</span>, balance: 80, gender: <span class="s2">&#34;M&#34;</span> <span class="o">}</span> <span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看账户余额在0到100之间的账户文档</span>
&gt; db.accounts.find<span class="o">({</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: 0, <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 80, <span class="s2">&#34;gender&#34;</span> : <span class="s2">&#34;M&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>也就是说，更新整篇文档的操作，只能应用在单一文档上</p>
</blockquote>
<h3 id="更新特定字段">更新特定字段</h3>
<p>如果<code>&lt;update&gt;</code>文档只包含更新操作符，<code>db.collection.update()</code>将会使用<code>&lt;update&gt;</code>文档更新集合中符合<code>&lt;query&gt;</code>筛选条件的所有文档中的特定字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 文档更新操作符</span>

<span class="nv">$set</span>        更新或新增字段
<span class="nv">$unset</span>      删除字段
<span class="nv">$rename</span>     重命名字段
<span class="nv">$inc</span>        加减字段值
<span class="nv">$mul</span>        相乘字段值
<span class="nv">$min</span>        比较减小字段值
<span class="nv">$max</span>        比较增大字段值
</code></pre></td></tr></table>
</div>
</div><h4 id="set操作符">$set操作符</h4>
<p>更新或新增字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$set</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value1&gt;, &lt;field2&gt;: &lt;value2&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 2000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;11111111&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 更新 jack 的银行账户余额和开户信息</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            balance: 3000,
            info: <span class="o">{</span>
                dateOpened: new Date<span class="o">(</span><span class="s2">&#34;2019-05-18T16:00:00Z&#34;</span><span class="o">)</span>,
                branch: <span class="s2">&#34;branch1&#34;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 3000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;11111111&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2019-05-18T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">## 更新或新增内嵌文档的字段</span>

<span class="c1"># 更新 jack 的银行账户的开户时间</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            <span class="s2">&#34;info.dateOpened&#34;</span>: new Date<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 3000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;11111111&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">## 更新或新增数组内的元素</span>

<span class="c1"># 更新 jack 的联系电话</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.0&#34;</span>: <span class="s2">&#34;66666666&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 3000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;66666666&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1"># 添加 jack 的联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.3&#34;</span>: <span class="s2">&#34;new contact&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 3000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;66666666&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>,
		<span class="s2">&#34;new contact&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1"># 数组索引可以随便设置</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.10&#34;</span>: <span class="s2">&#34;new contact 10&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 3000,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;66666666&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>,
		<span class="s2">&#34;new contact&#34;</span>,
		null,
		null,
		null,
		null,
		null,
		null,
		<span class="s2">&#34;new contact10&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
如果向现有数组字段范围以外的位置添加新值，数组字段的长度会扩大，未被赋值的数组成员将被设置为<code>null</code></p>
</blockquote>
<h4 id="unset-操作符">$unset 操作符</h4>
<p>删除字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$unset</span>: <span class="o">{</span> &lt;field1&gt;: <span class="s2">&#34;&#34;</span>, &lt;field2&gt;: <span class="s2">&#34;&#34;</span>, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 删除 jack 的银行账户余额和开户地点</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$unset</span>: <span class="o">{</span>
            balance: <span class="s2">&#34;&#34;</span>,
            <span class="s2">&#34;info.branch&#34;</span>: <span class="s2">&#34;&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;66666666&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>,
		<span class="s2">&#34;new contact2&#34;</span>,
		null,
		null,
		null,
		null,
		null,
		null,
		<span class="s2">&#34;new contact10&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="c1">## 删除数组内的字段</span>

<span class="c1"># 删除 jack 的联系电话</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$unset</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.0&#34;</span>: <span class="s2">&#34;&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		null,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>,
		<span class="s2">&#34;new contact2&#34;</span>,
		null,
		null,
		null,
		null,
		null,
		null,
		<span class="s2">&#34;new contact10&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>

	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>$unset</code>操作符中的赋值(<code>&quot;&quot;</code>)对操作结果并没有任何影响</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 删除 jack 的银行开户时间</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$unset</span>: <span class="o">{</span>
            <span class="s2">&#34;info.dateOpened&#34;</span>: <span class="s2">&#34;this can be any value&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 再次查看 jack 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;66666666&#34;</span>,
		<span class="s2">&#34;Alabama&#34;</span>,
		<span class="s2">&#34;US&#34;</span>,
		<span class="s2">&#34;new contact2&#34;</span>,
		null,
		null,
		null,
		null,
		null,
		null,
		<span class="s2">&#34;new contact10&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>

	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果<code>$unset</code>命令中的字段根本不存在，那么文档内容将保持不变<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$unset</span>: <span class="o">{</span>
            notExist: <span class="s2">&#34;&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>当使用<code>$unset</code>命令删除数组字段中的某一个元素时，这个元素不会被删除，只会被赋以<code>null</code>值，而数组的长度不会改变</p>
</blockquote>
<h4 id="rename-操作符">$rename 操作符</h4>
<p>重命名字段</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$rename</span>: <span class="o">{</span> &lt;field1&gt;: &lt;newName1&gt;, &lt;field2&gt;: &lt;newName2&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1">## 重命名内嵌文档的字段</span>

<span class="c1"># 更新 karen 的银行账户的开户时间和联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$set</span>: <span class="o">{</span>
            info: <span class="o">{</span>
                dateOpened: new Date<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
                branch: <span class="s2">&#34;branch1&#34;</span>
            <span class="o">}</span>,
            <span class="s2">&#34;contact.3&#34;</span>: <span class="o">{</span>
                primaryEmail: <span class="s2">&#34;xxx@gmail.com&#34;</span>,
                secondaryEmail: <span class="s2">&#34;yyy@gmail.com&#34;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;balance&#34;</span> : 2500,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1"># 更新账户余额和开户地点字段在文档中的位置</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$rename</span>: <span class="o">{</span>
            <span class="s2">&#34;info.branch&#34;</span>: <span class="s2">&#34;branch&#34;</span>,
            <span class="s2">&#34;balance&#34;</span>: <span class="s2">&#34;info.balance&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">2500</span>
	<span class="o">}</span>,
	<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>
<span class="o">}</span>


<span class="c1">## 重命名数组中内嵌文档的字段</span>

<span class="c1"># 更新 karen 的联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$rename</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.3.primaryEmail&#34;</span>: <span class="s2">&#34;primaryEmail&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;writeError&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;code&#34;</span> : 2,
		<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;The source field cannot be an array element, &#39;contact.3.primaryEmail&#39; in doc with _id: ObjectId(&#39;5ce1107d72e77e7cb392a90e&#39;) has an array field called &#39;contact&#39;&#34;</span>
	<span class="o">}</span>
<span class="o">})</span>

<span class="c1"># 反向操作</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$rename</span>: <span class="o">{</span>
            <span class="s2">&#34;branch&#34;</span>: <span class="s2">&#34;contact.3.branch&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;writeError&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;code&#34;</span> : 2,
		<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;The destination field cannot be an array element, &#39;contact.3.branch&#39; in doc with _id: ObjectId(&#39;5ce1107d72e77e7cb392a90e&#39;) has an array field called &#39;contact&#39;&#34;</span>
	<span class="o">}</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
如果<code>$rename</code>命令要重命名的字段在文档中并不存在，那么文档内容不会发生任何改变</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$rename</span>: <span class="o">{</span>
            notExist: <span class="s2">&#34;name&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果新的字段名已经存在，那么原有的这个字段会被覆盖</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$rename</span>: <span class="o">{</span>
            name: <span class="s2">&#34;contact&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;jack&#34;</span> <span class="o">})</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="s2">&#34;jack&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>

	<span class="o">}</span>
        <span class="c1"># 原来的 contact 内容不见了!!!</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>当<code>$rename</code>命令中的新字段存在的时候，<code>$rename</code>命令会先<code>$unset</code>新旧字段，然后再<code>$set</code>新字段<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<code>$rename</code>命令中的旧字段和新字段都不可以指向数组元素<!-- raw HTML omitted --></p>
</blockquote>
<h4 id="inc-和-mul-操作符">$inc 和 $mul 操作符</h4>
<p>更新字段值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$inc</span>: <span class="o">{</span> &lt;field1&gt;: &lt;amount1&gt;, ... <span class="o">}</span> <span class="o">}</span>
<span class="o">{</span> <span class="nv">$mul</span>: <span class="o">{</span> &lt;field1&gt;: &lt;amount1&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 查看 david 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>

<span class="c1"># 更新 david 的账户余额</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$inc</span>: <span class="o">{</span>
            balance: -0.5
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 david 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 199.5 <span class="o">}</span>

<span class="c1"># 更新 david 的账户余额</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$mul</span>: <span class="o">{</span>
            balance: 0.5
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 david 的银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75 <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<code>$inc</code>和<code>$mul</code>命令只能应用在数字字段上</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$inc</span>: <span class="o">{</span>
            name: -0.5
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;writeError&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;code&#34;</span> : 14,
		<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;Cannot apply </span><span class="nv">$inc</span><span class="s2"> to a value of non-numeric type. {_id: ObjectId(&#39;5ce00d5972e77e7cb392a8ff&#39;)} has the field &#39;name&#39; of non-numeric type string&#34;</span>
	<span class="o">}</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果被<code>$inc</code>或<code>$mul</code>更新的字段不存在。。。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$inc</span>: <span class="o">{</span>
            notYetExist: <span class="m">10</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75, <span class="s2">&#34;notYetExist&#34;</span> : <span class="m">10</span> <span class="o">}</span>

&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$mul</span>: <span class="o">{</span>
            notYetExistEither: <span class="m">20</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;david&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75, <span class="s2">&#34;notYetExist&#34;</span> : 10, <span class="s2">&#34;notYetExistEither&#34;</span> : <span class="m">0</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="min-和-max-操作符">$min 和 $max 操作符</h4>
<p>比较之后更新字段值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法: 
<span class="o">{</span> <span class="nv">$min</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value1&gt;, ... <span class="o">}</span> <span class="o">}</span>
<span class="o">{</span> <span class="nv">$max</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value1&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, info: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">2500</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1"># 更新 karen 的账户余额</span>
<span class="c1"># 比较 info.balance 字段原本的字段值与5000的大小，把这两者中较小的保留，作为 info.balance 字段的值</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$min</span>: <span class="o">{</span>
            <span class="s2">&#34;info.balance&#34;</span>: <span class="m">5000</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>

<span class="c1"># 更新 karen 的账户余额</span>
<span class="c1"># 比较 info.balance 字段原本的字段值与5000的大小，把这两者中较大的保留，作为 info.balance 字段的值</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$max</span>: <span class="o">{</span>
            <span class="s2">&#34;info.balance&#34;</span>: <span class="m">5000</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, info: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2017-01-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">5000</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1"># 更新 karen 的开户时间</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$min</span>: <span class="o">{</span>
            <span class="s2">&#34;info.dateOpened&#34;</span>: new Date<span class="o">(</span><span class="s2">&#34;2013-10-01T16:00:00Z&#34;</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, info: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2013-10-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">5000</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
如果被更新的字段不存在。。。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$min</span>: <span class="o">{</span>
            notYetExist: <span class="m">10</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 kaven 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, info: 1, notYetExist: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2013-10-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : <span class="m">5000</span>
	<span class="o">}</span>,
	<span class="s2">&#34;notYetExist&#34;</span> : <span class="m">10</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果被更新的字段不存在，<code>$min</code>和<code>$max</code>命令会创建字段，并且将字段值设置为命令中的更新值<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
如果被更新的字段类型和更新值类型不一致。。。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$min</span>: <span class="o">{</span>
            <span class="s2">&#34;info.balance&#34;</span>: null
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, info: 1, notYetExist: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2013-10-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : null
	<span class="o">}</span>,
	<span class="s2">&#34;notYetExist&#34;</span> : <span class="m">10</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果被更新的字段类型和更新值类型不一致，<code>$min</code>和<code>$max</code>命令会按照<code>BSON</code>数据类型排序规则进行比较<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">(</span><span class="nx">最小</span><span class="p">)</span>
<span class="nx">Null</span>
<span class="nx">Numbers</span> <span class="p">(</span><span class="nx">ints</span><span class="p">,</span> <span class="nx">longs</span><span class="p">,</span> <span class="nx">doubles</span><span class="p">,</span> <span class="nx">decimals</span><span class="p">)</span>
<span class="nx">Symbol</span><span class="p">,</span> <span class="nb">String</span>
<span class="nb">Object</span>
<span class="nb">Array</span>
<span class="nx">BinData</span>
<span class="nx">ObjectId</span>
<span class="nb">Boolean</span>
<span class="nb">Date</span>
<span class="nx">Timestamp</span>
<span class="nx">Regular</span> <span class="nx">Expression</span>
<span class="p">(</span><span class="nx">最大</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="数组更新操作符">数组更新操作符</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$addToSet</span>   向数组中增添元素
<span class="nv">$pop</span>        从数组中移除元素
<span class="nv">$pull</span>       从数组中有选择性地移除元素
<span class="nv">$pullAll</span>    从数组中有选择性地移除元素
<span class="nv">$push</span>       向数组中增添元素
</code></pre></td></tr></table>
</div>
</div><h4 id="addtoset-操作符">$addToSet 操作符</h4>
<p>向数组字段中添加元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$addToSet</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value1&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 向 karen 的账户文档中添加联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$addToSet</span>: <span class="o">{</span>
            contact: <span class="s2">&#34;China&#34;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
如果要插入的值已经存在数组字段中，则<code>$addToSet</code>不会再添加重复值<!-- raw HTML omitted -->
注意一下，使用<code>$addToSet</code>插入数组和文档时，插入值中的字段顺序也和已有值重复的时候，才被算作重复值被忽略<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 向 karen 的账户文档中添加新的联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$addToSet</span>: <span class="o">{</span>
            contact: <span class="o">{</span>
                <span class="s2">&#34;secondaryEmail&#34;</span>: <span class="s2">&#34;yyy@gmail.com&#34;</span>,
                <span class="s2">&#34;primaryEmail&#34;</span>: <span class="s2">&#34;xxx@gmail.com&#34;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1">## 向数组字段中添加多个值</span>

<span class="c1"># 向 karen 的账户文档中添加多个联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$addToSet</span>: <span class="o">{</span>
            contact: <span class="o">[</span> <span class="s2">&#34;contact1&#34;</span>, <span class="s2">&#34;contact2&#34;</span> <span class="o">]</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span>
			<span class="s2">&#34;contact1&#34;</span>,
			<span class="s2">&#34;contact2&#34;</span>
		<span class="o">]</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1">#由此可见，默认情况下，$addToSet 会将数组插入被更新的数组字段中，成为内嵌数组</span>
<span class="c1">#如果想要将多个元素直接添加到数组字段中，则需要使用 $each 操作符</span>

<span class="c1"># 向 karen 的账户文档中添加多个联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$addToSet</span>: <span class="o">{</span>
            contact: <span class="o">{</span>
                <span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;contact1&#34;</span>, <span class="s2">&#34;contact2&#34;</span> <span class="o">]</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span>
			<span class="s2">&#34;contact1&#34;</span>,
			<span class="s2">&#34;contact2&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>,
		<span class="s2">&#34;contact2&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="pop-操作符">$pop 操作符</h4>
<p>从数组字段中删除元素(只能删除数组中第一个或者最后一个元素)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$pop</span>: <span class="o">{</span> &lt;field&gt;: &lt;-1 <span class="p">|</span> 1&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 从 karen 的账户文档中删除最后一个联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$pop</span>: <span class="o">{</span>
            contact: <span class="m">1</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span>
			<span class="s2">&#34;contact1&#34;</span>,
			<span class="s2">&#34;contact2&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 从 karen 的账户文档中删除第一个联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span>
        <span class="nv">$pop</span>: <span class="o">{</span>
            <span class="s2">&#34;contact.5&#34;</span>: -1
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span>
			<span class="s2">&#34;contact2&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 继续从 karen 的账户文档中删除联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pop</span>: <span class="o">{</span>
			<span class="s2">&#34;contact.5&#34;</span>: -1
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
    <span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
    <span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
删除掉数组中最后一个元素后，会留下空数组<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<code>$pop</code>操作符只能应用在数组字段上<!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pop</span>: <span class="o">{</span>
			<span class="s2">&#34;contact.1&#34;</span>: -1
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 0,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;writeError&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;code&#34;</span> : 14,
		<span class="s2">&#34;errmsg&#34;</span> : <span class="s2">&#34;Path &#39;contact.1&#39; contains an element of non-array type &#39;string&#39;&#34;</span>
	<span class="o">}</span>
<span class="o">})</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="pull-操作符">$pull 操作符</h4>
<p>从数组字段中删除特定元素(灵活性比<code>$pop</code>强)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$pull</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value <span class="p">|</span> condition&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 为了演示方便，首先将 karen 的账户文档复制成为一篇新文档，并且把新文档的用户姓名设置为 lawrence</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.forEach<span class="o">(</span><span class="nv">doc</span> <span class="o">=</span>&gt; <span class="o">{</span>
	var <span class="nv">newDoc</span> <span class="o">=</span> doc<span class="p">;</span>
	newDoc.name <span class="o">=</span> <span class="s2">&#34;lawrence&#34;</span><span class="p">;</span>
	db.accounts.insert<span class="o">(</span>newDoc<span class="o">)</span><span class="p">;</span>
<span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span> <span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span> <span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce188c687c9a4c5934a9550&#34;</span><span class="o">)</span>,
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>,
	<span class="s2">&#34;info&#34;</span> : <span class="o">{</span>
		<span class="s2">&#34;dateOpened&#34;</span> : ISODate<span class="o">(</span><span class="s2">&#34;2013-10-01T16:00:00Z&#34;</span><span class="o">)</span>,
		<span class="s2">&#34;balance&#34;</span> : null
	<span class="o">}</span>,
	<span class="s2">&#34;branch&#34;</span> : <span class="s2">&#34;branch1&#34;</span>,
	<span class="s2">&#34;notYetExist&#34;</span> : <span class="m">10</span>
<span class="o">}</span>

<span class="c1"># 从 karen 的联系方式中删除包含 &#39;hi&#39; 字母的元素</span>
<span class="c1"># 想一想，既然是针对数组元素的筛选条件，是否需要使用 $elemMatch 操作符呢？</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pull</span>: <span class="o">{</span>
			contact: <span class="o">{</span>
				<span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$regex</span>: /hi/ <span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>

<span class="c1"># 事实上，既然 $pull 操作符本身是只能作用在数组元素上的，我们便不需要再额外使用 $elemMatch 操作符了</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pull</span>: <span class="o">{</span>
			contact: <span class="o">{</span> <span class="nv">$regex</span>: /hi/ <span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 当然，如果有数组元素本身就是一个内嵌数组，我们也可以使用 $elemMatch 来对这些内嵌数组进行筛选</span>

<span class="c1"># 从 karen 的联系方式中删除电话号码 22222222</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pull</span>: <span class="o">{</span>
			contact: <span class="o">{</span> <span class="nv">$elemMatch</span>: <span class="o">{</span> <span class="nv">$eq</span>: <span class="s2">&#34;22222222&#34;</span> <span class="o">}}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 karen 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
<span class="c1"># 这里需要说明一下，虽然 $elemMatch 匹配的是内嵌数组中的元素，但是 $pull 的删除操作是针对 contact 的顶级元素进行的，所以会把符合内嵌数组中的筛选条件的元素所在的顶级元素整个删除掉。</span>
<span class="c1"># 因此，33333333没有出现在查询结果中</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="pullall-操作符">$pullAll 操作符</h4>
<p>从数组字段中删除特定元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="o">{</span> <span class="nv">$pull</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value&gt;, ... <span class="o">}</span> <span class="o">}</span>
<span class="o">{</span> <span class="nv">$pullAll</span>: <span class="o">{</span> &lt;field1&gt;: <span class="o">[</span> &lt;value1&gt;, &lt;value2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>

<span class="o">{</span> <span class="nv">$pullAll</span>: <span class="o">{</span> &lt;field1&gt;: <span class="o">[</span> &lt;value1&gt;, &lt;value2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
相当于
<span class="o">{</span> <span class="nv">$pull</span>: <span class="o">{</span> &lt;field1&gt;: <span class="o">{</span> <span class="nv">$in</span>: <span class="o">[</span> &lt;value1&gt;, &lt;value2&gt;, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span>

<span class="c1">## 如果要删除的元素是一个内嵌数组，则数组元素的值和排列顺序都必须和被删除的数组完全一样</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 删除第一个联系方式</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pullAll</span>: <span class="o">{</span>
			contact: <span class="o">[</span> <span class="o">[</span><span class="s2">&#34;33333333&#34;</span>, <span class="s2">&#34;22222222&#34;</span><span class="o">]</span> <span class="o">]</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>
<span class="c1"># 因为排列顺序不一样，所以没有被删除</span>

<span class="c1">## 如果要删除的元素是一个内嵌文档</span>
<span class="nv">$pullAll</span> 命令只会删除字段和字段排列顺序都完全匹配的文档元素

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>,
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pullAll</span>: <span class="o">{</span>
			contact: <span class="o">[</span> <span class="o">{</span><span class="s2">&#34;primaryEmail&#34;</span>:<span class="s2">&#34;xxx@gmail.com&#34;</span><span class="o">}</span> <span class="o">]</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">0</span> <span class="o">})</span>
<span class="c1"># 因为提供给 $pullAll 的文档和源文档并没有完全匹配，所以没有删除</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pullAll</span>: <span class="o">{</span>
			contact: <span class="o">[</span> 
				<span class="o">{</span> <span class="s2">&#34;secondaryEmail&#34;</span>: <span class="s2">&#34;yyy@gmail.com&#34;</span>, <span class="s2">&#34;primaryEmail&#34;</span>: <span class="s2">&#34;xxx@gmail.com&#34;</span> <span class="o">}</span>,
			<span class="o">]</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>
<span class="c1"># 只会删除第二个内嵌文档</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">{</span>
			<span class="s2">&#34;primaryEmail&#34;</span> : <span class="s2">&#34;xxx@gmail.com&#34;</span>,
			<span class="s2">&#34;secondaryEmail&#34;</span> : <span class="s2">&#34;yyy@gmail.com&#34;</span>
		<span class="o">}</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 但是，$pull 命令会删除包含指定的文档字段和字段值的文档元素，字段排列顺序不需要完全匹配。</span>
<span class="c1"># 这一点和 $pullAll 不太一样</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pull</span>: <span class="o">{</span>
			contact: <span class="o">{</span>
				<span class="s2">&#34;primaryEmail&#34;</span>: <span class="s2">&#34;xxx@gmail.com&#34;</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>
<span class="c1"># $pull 在删除内嵌文档的时候，允许部分匹配，他的模糊程度更高</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 将刚才删除的文档元素再添加到 contact 数组中去</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$addToSet</span>: <span class="o">{</span>
			contact: <span class="o">{</span>
				<span class="s2">&#34;primaryEmail&#34;</span>: <span class="s2">&#34;xxx@gmail.com&#34;</span>,
				<span class="s2">&#34;secondaryEmail&#34;</span>: <span class="s2">&#34;yyy@gmail.com&#34;</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$pull</span>: <span class="o">{</span>
			contact: <span class="o">{</span>
				<span class="s2">&#34;secondaryEmail&#34;</span>: <span class="s2">&#34;yyy@gmail.com&#34;</span>,
				<span class="s2">&#34;primaryEmail&#34;</span>: <span class="s2">&#34;xxx@gmail.com&#34;</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>
<span class="c1"># 可以看到，$pull 在删除内嵌文档时，对字段的排列顺序没有要求</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="push-操作符">$push 操作符</h4>
<p>向数组字段中添加元素</p>
<p><code>$push</code>和<code>$addToSet</code>命令相似，但是<code>$push</code>命令的功能更强大</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> <span class="nv">$push</span>: <span class="o">{</span> &lt;field1&gt;: &lt;value1&gt;, ... <span class="o">}</span> <span class="o">}</span>

<span class="c1"># 和 $addToSet 命令一样，如果 $push 命令中指定的数组字段不存在，则这个字段会被添加到原文档中</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="s2">&#34;new element&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>, <span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span> <span class="s2">&#34;new element&#34;</span> <span class="o">]</span> <span class="o">}</span>

<span class="c1">## 和 $addToSet 相似，$push 操作符也可以和 $each 搭配使用</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> 2, 3, <span class="m">4</span> <span class="o">]</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>, <span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span> <span class="s2">&#34;new element&#34;</span>, 2, 3, <span class="m">4</span> <span class="o">]</span> <span class="o">}</span>


<span class="c1">## $push 和 $each 操作符还可以和更多的操作符搭配使用，实现比 $addToSet 更复杂的操作</span>

<span class="c1">## 使用 $position 操作符将元素插入到数组的指定位置</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;pos1&#34;</span>, <span class="s2">&#34;pos2&#34;</span> <span class="o">]</span>,
				<span class="nv">$position</span>: <span class="m">0</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;new element&#34;</span>,
		2,
		3,
		<span class="m">4</span>
	<span class="o">]</span>
<span class="o">}</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;pos3&#34;</span>, <span class="s2">&#34;pos4&#34;</span> <span class="o">]</span>,
				<span class="nv">$position</span>: -1  <span class="c1">#插入到最后一个元素的前面</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;new element&#34;</span>,
		2,
		3,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos4&#34;</span>,
		<span class="m">4</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1">## 使用 $sort 对数组进行排序</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;sort1&#34;</span> <span class="o">]</span>,
				<span class="nv">$sort</span>: <span class="m">1</span>  <span class="c1"># 1升序 -1降序</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		2,
		3,
		4,
		<span class="s2">&#34;new element&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos4&#34;</span>,
		<span class="s2">&#34;sort1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 如果插入的元素是一个内嵌文档，也可以根据内嵌文档的字段值进行排序</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="o">{</span> key: <span class="s2">&#34;sort&#34;</span>, value: <span class="m">100</span> <span class="o">}</span>, <span class="o">{</span> key: <span class="s2">&#34;sort&#34;</span>, value: <span class="m">200</span> <span class="o">}</span> <span class="o">]</span>,
				<span class="nv">$sort</span>: <span class="o">{</span> value: -1 <span class="o">}</span>  <span class="c1"># 1升序 -1降序</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="o">{</span>
			<span class="s2">&#34;key&#34;</span> : <span class="s2">&#34;sort&#34;</span>,
			<span class="s2">&#34;value&#34;</span> : <span class="m">200</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;key&#34;</span> : <span class="s2">&#34;sort&#34;</span>,
			<span class="s2">&#34;value&#34;</span> : <span class="m">100</span>
		<span class="o">}</span>,
		2,
		3,
		4,
		<span class="s2">&#34;new element&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos4&#34;</span>,
		<span class="s2">&#34;sort1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 如果不想插入元素，只想对文档中的数组字段进行排序。。。</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="o">]</span>,
				<span class="nv">$sort</span>: -1
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="o">{</span>
			<span class="s2">&#34;key&#34;</span> : <span class="s2">&#34;sort&#34;</span>,
			<span class="s2">&#34;value&#34;</span> : <span class="m">200</span>
		<span class="o">}</span>,
		<span class="o">{</span>
			<span class="s2">&#34;key&#34;</span> : <span class="s2">&#34;sort&#34;</span>,
			<span class="s2">&#34;value&#34;</span> : <span class="m">100</span>
		<span class="o">}</span>,
		<span class="s2">&#34;sort1&#34;</span>,
		<span class="s2">&#34;pos4&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;new element&#34;</span>,
		4,
		3,
		<span class="m">2</span>
	<span class="o">]</span>
<span class="o">}</span>


<span class="c1">## 使用 $slice 来截取数组的一部分</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;slice1&#34;</span> <span class="o">]</span>,
				<span class="nv">$slice</span>: -8  <span class="c1">#只保留最后8个元素，其他的都被删除掉</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;new element&#34;</span>,
		4,
		3,
		2,
		<span class="s2">&#34;slice1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 如果不想插入元素，只想截取文档中的数组字段。。。</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="o">]</span>,
				<span class="nv">$slice</span>: <span class="m">6</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>,
		<span class="s2">&#34;new element&#34;</span>,
		4,
		<span class="m">3</span>
	<span class="o">]</span>
<span class="o">}</span>


<span class="c1">## $position, $sort, $slice 可以一起使用</span>
<span class="c1"># 这三个操作符的执行顺序是:</span>
<span class="c1"># $position -&gt; $sort -&gt; $slice</span>
<span class="c1"># 写在命令中的操作符顺序并不重要，并不会影响命令的执行顺序</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$push</span>: <span class="o">{</span>
			newArray: <span class="o">{</span>
				<span class="nv">$each</span>: <span class="o">[</span> <span class="s2">&#34;push1&#34;</span>, <span class="s2">&#34;push2&#34;</span> <span class="o">]</span>,
				<span class="nv">$position</span>: 2,
				<span class="nv">$sort</span>: -1,
				<span class="nv">$slice</span>: <span class="m">5</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;push2&#34;</span>,
		<span class="s2">&#34;push1&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="占位操作符">$占位操作符</h4>
<p>更新数组中的特定元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
db.collection.update<span class="o">(</span>
	<span class="o">{</span> &lt;array&gt;: &lt;query selector&gt; <span class="o">}</span>,
	<span class="o">{</span> &lt;update operator&gt;: <span class="o">{</span> <span class="s2">&#34;&lt;array&gt;.</span>$<span class="s2">&#34;</span>: value <span class="o">}</span> <span class="o">}</span>
<span class="o">)</span>
$ 是数组中第一个符合筛选条件的数组元素的占位符
搭配更新操作符使用，可以对满足筛选条件的数组元素进行更新

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;push2&#34;</span>,
		<span class="s2">&#34;push1&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;pos2&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span>, newArray: <span class="s2">&#34;pos2&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			<span class="s2">&#34;newArray.</span>$<span class="s2">&#34;</span>: <span class="s2">&#34;updated&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, newArray: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;newArray&#34;</span> : <span class="o">[</span>
		<span class="s2">&#34;push2&#34;</span>,
		<span class="s2">&#34;push1&#34;</span>,
		<span class="s2">&#34;pos3&#34;</span>,
		<span class="s2">&#34;updated&#34;</span>,
		<span class="s2">&#34;pos1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>更新数组中的所有元素</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
db.collection.update<span class="o">(</span>
	<span class="o">{</span> &lt;query&gt; <span class="o">}</span>,
	<span class="o">{</span> &lt;update operator&gt;: <span class="o">{</span> <span class="s2">&#34;&lt;array&gt;.</span>$<span class="s2">[]&#34;</span>: value <span class="o">}</span> <span class="o">}</span>
<span class="o">)</span>

$<span class="o">[]</span> 指代数组字段中的所有元素
搭配更新操作符使用，可以对数组中所有的元素进行更新

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;22222222&#34;</span>,
			<span class="s2">&#34;33333333&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			<span class="s2">&#34;contact.0.</span>$<span class="s2">[]&#34;</span>: <span class="s2">&#34;88888888&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看 lawrence 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, contact: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span>
	<span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span>,
	<span class="s2">&#34;contact&#34;</span> : <span class="o">[</span>
		<span class="o">[</span>
			<span class="s2">&#34;88888888&#34;</span>,
			<span class="s2">&#34;88888888&#34;</span>
		<span class="o">]</span>,
		<span class="s2">&#34;Beijing&#34;</span>,
		<span class="s2">&#34;China&#34;</span>,
		<span class="o">[</span> <span class="o">]</span>,
		<span class="s2">&#34;contact1&#34;</span>
	<span class="o">]</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="update-options">update options</h3>
<p><code>db.&lt;collection&gt;.update(&lt;query&gt;, &lt;update&gt;, &lt;options&gt;)</code></p>
<p><code>&lt;options&gt;</code>参数提供了<code>update</code>命令的更多选项</p>
<h4 id="multi-更新多个文档">multi 更新多个文档</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> multi: &lt;boolean&gt; <span class="o">}</span>

在默认情况下，即使筛选条件对应了多篇文档，update命令仍然只会更新一篇文档

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			currency: <span class="s2">&#34;USD&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, currency: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>

<span class="c1"># 使用 multi 选项来更新多个符合筛选条件的文档</span>
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			currency: <span class="s2">&#34;USD&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>,
	<span class="o">{</span> multi: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 24, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">23</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, currency: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.pretty<span class="o">()</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;currency&#34;</span> : <span class="s2">&#34;USD&#34;</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意: <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<code>MongoDB</code>只能保证<strong>单个</strong>文档操作的原子性，不能保证<strong>多个</strong>文档操作的原子性<!-- raw HTML omitted -->
更新多个文档的操作虽然在单一线程中执行，但是线程在执行过程中可能会被挂起，以便其他线程也有机会对数据进行操作<!-- raw HTML omitted -->
如果需要保证多个文档操作时的原子性，就需要使用<code>MongoDB 4.0</code>版本中引入的事物功能进行操作<!-- raw HTML omitted --></p>
</blockquote>
<h4 id="upsert-更新或创建文档">upsert 更新或创建文档</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
<span class="o">{</span> upsert: &lt;boolean&gt; <span class="o">}</span>

在默认情况下，如果 update 命令中的筛选条件没有匹配任何文档，则不会进行任何操作
将 upsert 选项设置为 true, 如果 update 命令中的筛选条件没有匹配任何文档，则会创建新文档

<span class="c1"># 查看 maggie 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;maggie&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>
无输出，说明没有这个用户

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;maggie&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			balance: <span class="m">700</span>
		<span class="o">}</span>
	<span class="o">}</span>,
	<span class="o">{</span> upsert: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 1,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce23eaf65fdd3b3b65b3810&#34;</span><span class="o">)</span>
<span class="o">})</span>

<span class="c1"># 查看 maggie 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;maggie&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;maggie&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">700</span> <span class="o">}</span>

如果无法从筛选条件中推断出确定的字段值，新创建的文档将不会包含筛选条件涉及的字段

&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$gt</span>: <span class="m">20000</span> <span class="o">}</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			name: <span class="s2">&#34;nick&#34;</span>
		<span class="o">}</span>
	<span class="o">}</span>,
	<span class="o">{</span> upsert: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span>
	<span class="s2">&#34;nMatched&#34;</span> : 0,
	<span class="s2">&#34;nUpserted&#34;</span> : 1,
	<span class="s2">&#34;nModified&#34;</span> : 0,
	<span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce2403b65fdd3b3b65b3869&#34;</span><span class="o">)</span>
<span class="o">})</span>

<span class="c1"># 查看 nick 的银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{</span> name: <span class="s2">&#34;nick&#34;</span> <span class="o">}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;nick&#34;</span> <span class="o">}</span>
<span class="c1"># 👆这里没有包含 balance 字段</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="save">save</h4>
<p>这个命令也可以用来更新文档</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
db.&lt;collection&gt;.save<span class="o">(</span>&lt;document&gt;<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>如果<code>document</code>文档中包含了<code>_id</code>字段，<code>save()</code>命令将会调用<code>db.collection.update()</code>命令(<code>upsert</code>选项被打开)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, _id: <span class="m">1</span> <span class="o">}</span>
<span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00c9672e77e7cb392a8fd&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8fe&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;charlie&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00d5972e77e7cb392a8ff&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce00f5272e77e7cb392a901&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce011fd72e77e7cb392a902&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;george&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce0f15c72e77e7cb392a90c&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;001&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;savings&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;002&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="o">{</span> <span class="s2">&#34;type&#34;</span> : <span class="s2">&#34;alipay&#34;</span>, <span class="s2">&#34;accountId&#34;</span> : <span class="s2">&#34;003&#34;</span> <span class="o">}</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90d&#34;</span><span class="o">)</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1107d72e77e7cb392a90e&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;5ce1225972e77e7cb392a90f&#34;</span><span class="o">)</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span> <span class="o">}</span>

<span class="c1"># _id已存在，更新已有文档</span>
&gt; db.accounts.save<span class="o">(</span>
	<span class="o">{</span> _id: <span class="s2">&#34;account1&#34;</span>, name: <span class="s2">&#34;alice&#34;</span>, balance: <span class="m">100</span> <span class="o">}</span>
<span class="o">)</span>
相当于执行
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> _id: <span class="s2">&#34;account1&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			name: <span class="s2">&#34;alice&#34;</span>,
			balance: <span class="m">100</span>
		<span class="o">}</span>
	<span class="o">}</span>,
	<span class="o">{</span> upsert: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 1, <span class="s2">&#34;nUpserted&#34;</span> : 0, <span class="s2">&#34;nModified&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;alice&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account1&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>


<span class="c1"># _id不存在，创建新文档</span>
&gt; db.accounts.save<span class="o">(</span>
	<span class="o">{</span> _id: <span class="s2">&#34;account2&#34;</span>, name: <span class="s2">&#34;oliver&#34;</span>, balance: <span class="m">100</span> <span class="o">}</span>
<span class="o">)</span>
相当于执行
&gt; db.accounts.update<span class="o">(</span>
	<span class="o">{</span> _id: <span class="s2">&#34;account2&#34;</span> <span class="o">}</span>,
	<span class="o">{</span>
		<span class="nv">$set</span>: <span class="o">{</span>
			name: <span class="s2">&#34;oliver&#34;</span>,
			balance: <span class="m">100</span>
		<span class="o">}</span>
	<span class="o">}</span>,
	<span class="o">{</span> upsert: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nMatched&#34;</span> : 0, <span class="s2">&#34;nUpserted&#34;</span> : 1, <span class="s2">&#34;nModified&#34;</span> : 0, <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account2&#34;</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">({</span> name: <span class="s2">&#34;oliver&#34;</span> <span class="o">})</span>
<span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;account2&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;oliver&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="删除文档">删除文档</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
db.&lt;collection&gt;.remove<span class="o">(</span>&lt;query&gt;, &lt;options&gt;<span class="o">)</span>

<span class="c1"># &lt;query&gt;文档定义了删除操作时筛选文档的条件</span>
<span class="c1"># 这里的&lt;query&gt;文档与 db.collection.find() 中的 &lt;query&gt; 文档是相同的</span>

<span class="c1"># &lt;options&gt;文档声明了一些删除操作的选项</span>


<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.sort<span class="o">({</span> balance: <span class="m">1</span> <span class="o">})</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;nick&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">80</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75 <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;alice&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;tom&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;oliver&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">100</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>

<span class="c1"># 删除余额为100的银行账户文档</span>
&gt; db.accounts.remove<span class="o">({</span> balance: <span class="m">100</span> <span class="o">})</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nRemoved&#34;</span> : <span class="m">4</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.sort<span class="o">({</span> balance: <span class="m">1</span> <span class="o">})</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;nick&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;bill&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">80</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75 <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>


<span class="c1"># 在默认情况下，remove 命令会删除所有符合筛选条件的文档</span>
<span class="c1"># 如果只想删除满足筛选条件的一篇文档，可以使用 justOne 选项</span>

<span class="c1"># 删除一篇余额小于100的银行账户文档</span>
&gt; db.accounts.remove<span class="o">(</span>
	<span class="o">{</span> balance: <span class="o">{</span> <span class="nv">$lt</span>: <span class="m">100</span> <span class="o">}</span> <span class="o">}</span>,
	<span class="o">{</span> justOne: <span class="nb">true</span> <span class="o">}</span>
<span class="o">)</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nRemoved&#34;</span> : <span class="m">1</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.sort<span class="o">({</span> balance: <span class="m">1</span> <span class="o">})</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;karen&#34;</span> <span class="o">}</span>
<span class="o">{</span>  <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;lawrence&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;nick&#34;</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;fred&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">20</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;david&#34;</span>, <span class="s2">&#34;balance&#34;</span> : 99.75 <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;john&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>
<span class="o">{</span> <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;champ&#34;</span>, <span class="s2">&#34;balance&#34;</span> : <span class="m">200</span> <span class="o">}</span>

<span class="c1"># 删除集合内的所有文档</span>
&gt; db.accounts.remove<span class="o">({})</span>
WriteResult<span class="o">({</span> <span class="s2">&#34;nRemoved&#34;</span> : <span class="m">22</span> <span class="o">})</span>

<span class="c1"># 查看银行账户文档</span>
&gt; db.accounts.find<span class="o">(</span>
	<span class="o">{}</span>,
	<span class="o">{</span> name: 1, balance: 1, _id: <span class="m">0</span> <span class="o">}</span>
<span class="o">)</span>.sort<span class="o">({</span> balance: <span class="m">1</span> <span class="o">})</span>
无输出
</code></pre></td></tr></table>
</div>
</div><h2 id="删除集合">删除集合</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">语法:
db.&lt;collection&gt;.drop<span class="o">(</span> <span class="o">{</span> writeConcern: &lt;document&gt; <span class="o">}</span> <span class="o">)</span>

这里的 writeConcern 文档定义了本次集合删除操作的安全写级别

<span class="c1"># 之前的 remove 命令可以删除集合内的所有文档，但是不会删除集合</span>
&gt; show collections
accounts

<span class="c1"># drop 命令可以删除整个集合，包括集合中的所有文档，以及集合的索引</span>
&gt; db.accounts.drop<span class="o">()</span>
<span class="nb">true</span>

&gt; show collections
无输出

<span class="c1"># 如果集合中的文档数量很多，使用 remove 命令删除所有文档的效率不高</span>
<span class="c1"># 这种情况下，更加有效率的方法，是使用 drop 命令删除整个集合，然后再创建空集合并创建索引</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://blog.champ.design/tags/mongo/">mongo</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2019/05/deno_install_explain/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Deno安装脚本的解读</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/2019/05/mac-cheat-sheet/">
            <span class="next-text nav-default">Mac 实用技巧</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://github.com/champkeh" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://blog.champ.design/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        champ
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
	
    
  













</body>
</html>
