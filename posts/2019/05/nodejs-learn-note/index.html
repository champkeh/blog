<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Nodejs之nextTick vs setImmediate - champ的个人博客</title>
<meta name=author content="champ">
<meta name=description content="champ的个人网站，分享一些自己在开发过程中的小知识已经一些小工具">
<meta name=keywords content="开发笔记，小工具">
<link rel=stylesheet href=/css/style.min.fa0868f50acb850007eddf2a140a2d223abd2a791a6e71094462ed65b2f033d8.css>
<link rel=stylesheet href=/js/app.min.32095c9383089bb169dd0ad8552d0d7044206daf16c5f53c90395500fe9cbc1f.css>
<script src=/js/app.min.1efa461e923265a55116bf3d81e23f569c18279542d6261f87075f4e8c0eddb6.js></script>
</head>
<body>
<div id=container class=container>
<header id=header>
<div class=wrapper>
<button class=round-left onclick="location.href='/'"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" aria-label="主页图标" class="css-ggaxow ellz05y0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M19 21H5a1 1 0 01-1-1v-9H1l10.327-9.388a1 1 0 011.346.0L23 11h-3v9a1 1 0 01-1 1zM6 19h12V9.157l-6-5.454-6 5.454V19z"/></g></svg>
回到主页</button>
<button class=round-right><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" aria-label="文章目录" class="css-ggaxow ellz05y0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M20 22H4a1 1 0 01-1-1V3a1 1 0 011-1h16a1 1 0 011 1v18a1 1 0 01-1 1zm-1-2V4H5v16h14zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"/></g></svg>
目录</button>
</div>
</header>
<main id=main>
<article class=post-single>
<header>
<h1>Nodejs之nextTick vs setImmediate</h1>
<span class=summary>关于 process.nextTick 和 setImmediate 执行时机的问题： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // 加入两个nextTick()的回调函数 process.nextTick(function () { console.log(&#3</span>
<div class=meta>
<time>
<i class="far fa-calendar"></i>
编辑于 2021 年 10 月 10 日
</time>
<a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank rel="noopener noreferrer">
<i class="far fa-copyright"></i>
CC-BY-SA-4.0
</a>
</div>
</header>
<section class=body>
<p>关于 <code>process.nextTick</code> 和 <code>setImmediate</code> 执行时机的问题：</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#60a0b0;font-style:italic>// 加入两个nextTick()的回调函数
</span><span style=color:#60a0b0;font-style:italic></span>process.nextTick(<span style=color:#007020;font-weight:700>function</span> () {
    console.log(<span style=color:#4070a0>&#39;nextTick延迟执行1&#39;</span>);
});
process.nextTick(<span style=color:#007020;font-weight:700>function</span> () {
    console.log(<span style=color:#4070a0>&#39;nextTick延迟执行2&#39;</span>);
});
<span style=color:#60a0b0;font-style:italic>// 加入两个setImmediate()的回调函数
</span><span style=color:#60a0b0;font-style:italic></span>setImmediate(<span style=color:#007020;font-weight:700>function</span> () {
    console.log(<span style=color:#4070a0>&#39;setImmediate延迟执行1&#39;</span>);
    <span style=color:#60a0b0;font-style:italic>// 进入下次循环
</span><span style=color:#60a0b0;font-style:italic></span>    process.nextTick(<span style=color:#007020;font-weight:700>function</span> () {
        console.log(<span style=color:#4070a0>&#39;强势插入&#39;</span>);
    });
});
setImmediate(<span style=color:#007020;font-weight:700>function</span> () {
    console.log(<span style=color:#4070a0>&#39;setImmediate延迟执行2&#39;</span>);
});
console.log(<span style=color:#4070a0>&#39;正常执行&#39;</span>);
</code></pre></td></tr></table>
</div>
</div><p>《nodejs深入浅出》的3.4章中的代码执行结果如下：</p>
<pre tabindex=0><code>正常执行
nextTick延迟执行1
nextTick延迟执行2
setImmediate延迟执行1
强势插入
setImmediate延迟执行2
</code></pre><p><a href=http://www.ituring.com.cn/book/miniarticle/62508 target=_blank rel=noopener>参见</a>
</p>
<p>可能是因为node版本不同，我在本地的执行结果如下：</p>
<pre tabindex=0><code>正常执行
nextTick延迟执行1
nextTick延迟执行2
setImmediate延迟执行1
setImmediate延迟执行2
强势插入
</code></pre><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ node -v
v10.15.0
</code></pre></td></tr></table>
</div>
</div><p><a href=http://plafer.github.io/2015/09/08/nextTick-vs-setImmediate/ target=_blank rel=noopener>nextTick vs setImmediate</a>
</p>
<p><a href=https://stackoverflow.com/questions/15349733/setimmediate-vs-nexttick target=_blank rel=noopener>stack-overflow</a>
</p>
<p><a href=https://nodejs.org/de/docs/guides/event-loop-timers-and-nexttick/ target=_blank rel=noopener>官方文档说明</a>
</p>
<p><a href=http://voidcanvas.com/setimmediate-vs-nexttick-vs-settimeout/ target=_blank rel=noopener>更多文章</a>
</p>
</section>
<section class=related>
<h3>Related</h3>
<ul>
<li><a href=/posts/2019/05/setup-your-own-git-server/>搭建自己的git服务器</a></li>
<li><a href=/about/></a></li>
</ul>
</section>
<div class=bottom-nav>
<a href=/posts/2019/05/setup-your-own-git-server/>&lt; 搭建自己的git服务器</a>
<a href=/posts/2019/05/linux-command/>Linux常用命令 ></a>
</div>
<section class=comments>
<h3>Comments</h3>
</section>
</article>
</main>
</div>
</body>
</html>