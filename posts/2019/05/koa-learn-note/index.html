<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Koa å­¦ä¹ ç¬”è®° - champçš„ä¸ªäººåšå®¢</title>
<meta name=author content="champ">
<meta name=description content="champçš„ä¸ªäººç½‘ç«™ï¼Œåˆ†äº«ä¸€äº›è‡ªå·±åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„å°çŸ¥è¯†å·²ç»ä¸€äº›å°å·¥å…·">
<meta name=keywords content="å¼€å‘ç¬”è®°ï¼Œå°å·¥å…·">
<link rel=stylesheet href=/css/style.min.a6e0964e1e9a867aed33f8845db710165bec788141b84fa0f56d20cb54f965ed.css>
<link rel=stylesheet href=/js/app.min.32095c9383089bb169dd0ad8552d0d7044206daf16c5f53c90395500fe9cbc1f.css>
<script src=/js/app.min.1efa461e923265a55116bf3d81e23f569c18279542d6261f87075f4e8c0eddb6.js></script>
</head>
<body>
<div id=container class=container>
<header id=header>
<div class=wrapper>
<button class=round-left onclick="location.href='/'"><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" aria-label="ä¸»é¡µå›¾æ ‡" class="css-ggaxow ellz05y0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M19 21H5a1 1 0 01-1-1v-9H1l10.327-9.388a1 1 0 011.346.0L23 11h-3v9a1 1 0 01-1 1zM6 19h12V9.157l-6-5.454-6 5.454V19z"/></g></svg>
å›åˆ°ä¸»é¡µ</button>
<button class=round-right><svg stroke="currentcolor" fill="currentcolor" stroke-width="0" viewBox="0 0 24 24" aria-label="æ–‡ç« ç›®å½•" class="css-ggaxow ellz05y0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M20 22H4a1 1 0 01-1-1V3a1 1 0 011-1h16a1 1 0 011 1v18a1 1 0 01-1 1zm-1-2V4H5v16h14zM8 7h8v2H8V7zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"/></g></svg>
ç›®å½•</button>
</div>
</header>
<main id=main>
<article class=post-single>
<header>
<h1>Koa å­¦ä¹ ç¬”è®°</h1>
<span class=summary>nodemonå·¥å…·çš„ä½¿ç”¨ Â¶ å·¥å…·è¯´æ˜: ç±»ä¼¼äºå‰ç«¯å¼€å‘ï¼Œæˆ‘å¸Œæœ›nodeæœåŠ¡å™¨è¿è¡Œèµ·æ¥ä¹‹åï¼Œå½“æˆ‘ä¿®æ”¹äº†æˆ‘çš„ä»£ç ä¹‹åï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨é‡å¯ï¼Œä¸éœ€è¦æˆ‘æ¯æ¬¡éƒ½</span>
<div class=meta>
<time>
<i class="far fa-calendar"></i>
ç¼–è¾‘äº 2019 å¹´ 05 æœˆ 10 æ—¥
</time>
<a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh target=_blank rel="noopener noreferrer">
<i class="far fa-copyright"></i>
CC-BY-SA-4.0
</a>
</div>
</header>
<aside>
<h2>Table of Contents</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#nodemonå·¥å…·çš„ä½¿ç”¨>nodemonå·¥å…·çš„ä½¿ç”¨</a></li>
<li><a href=#å…³äºgenerator>å…³äºGenerator</a></li>
<li><a href=#å…³äº-asyncawait-ä¸-promise>å…³äº async/await ä¸ Promise</a></li>
<li><a href=#å‚è€ƒ>å‚è€ƒ</a></li>
</ul>
</nav>
</aside>
<section class=body>
<h2 id=nodemonå·¥å…·çš„ä½¿ç”¨>nodemonå·¥å…·çš„ä½¿ç”¨ <a href=#nodemon%e5%b7%a5%e5%85%b7%e7%9a%84%e4%bd%bf%e7%94%a8 class=anchor>Â¶</a></h2>
<p>å·¥å…·è¯´æ˜: ç±»ä¼¼äºå‰ç«¯å¼€å‘ï¼Œæˆ‘å¸Œæœ›nodeæœåŠ¡å™¨è¿è¡Œèµ·æ¥ä¹‹åï¼Œå½“æˆ‘ä¿®æ”¹äº†æˆ‘çš„ä»£ç ä¹‹åï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨é‡å¯ï¼Œä¸éœ€è¦æˆ‘æ¯æ¬¡éƒ½æ‰‹åŠ¨é‡å¯æœåŠ¡ã€‚</p>
<p>é¡¹ç›®åœ°å€: <a href=https://github.com/remy/nodemon target=_blank rel=noopener>https://github.com/remy/nodemon</a>
</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ node install -g nodemon <span style=color:#60a0b0;font-style:italic>#å…¨å±€å®‰è£…</span>
$ nodemon app.js <span style=color:#60a0b0;font-style:italic>#ç”¨ nodemon æ›¿ä»£ node æ¥å¯åŠ¨åº”ç”¨</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=å…³äºgenerator>å…³äºGenerator <a href=#%e5%85%b3%e4%ba%8egenerator class=anchor>Â¶</a></h2>
<p>åœ¨è€çš„æ•™ç¨‹ä¸­ï¼Œä¸­é—´ä»¶çš„å†™æ³•ä¼šæœ‰å¾ˆå¤šç”Ÿæˆå™¨å‡½æ•°çš„ç”¨æ³•ï¼Œæ¯”å¦‚:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>app.use(<span style=color:#007020;font-weight:700>function</span><span style=color:#666>*</span> (next) {
    console.log(<span style=color:#4070a0>&#34;1&#34;</span>);
    <span style=color:#007020;font-weight:700>yield</span> next;
    console.log(<span style=color:#4070a0>&#34;2&#34;</span>);
});
</code></pre></td></tr></table>
</div>
</div><p>åœ¨koaçš„v2ç‰ˆä¸­ï¼Œå†™æ³•å‘ç”Ÿäº†å˜åŒ–:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>app.use(<span style=color:#007020;font-weight:700>async</span> (ctx, next) =&gt; {
    console.log(<span style=color:#4070a0>&#34;1&#34;</span>);
    <span style=color:#007020;font-weight:700>await</span> next();
    console.log(<span style=color:#4070a0>&#34;2&#34;</span>);
})
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä¸çŸ¥é“è¿™ä¸ªæ˜¯ä¸æ˜¯åªæ˜¯ä¸€ä¸ªè¯­æ³•çš„é—®é¢˜ï¼ŒæŠ½æ—¶é—´éœ€è¦ç ”ç©¶ä¸€ä¸‹ã€‚
é™„ä¸Šes6 generatorçš„æ•™ç¨‹
<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators target=_blank rel=noopener>MDN</a>
<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function* target=_blank rel=noopener>function*è¯­æ³•</a>
<a href=http://es6.ruanyifeng.com/#docs/generator target=_blank rel=noopener>é˜®ä¸€å³°çš„æ–‡ç« </a>
<a href=https://blog.risingstack.com/introduction-to-koa-generators/ target=_blank rel=noopener>introduction to koa generator</a>
</p>
</blockquote>
<h2 id=å…³äº-asyncawait-ä¸-promise>å…³äº async/await ä¸ Promise <a href=#%e5%85%b3%e4%ba%8e-asyncawait-%e4%b8%8e-promise class=anchor>Â¶</a></h2>
<p>async/await æ˜¯ Promise çš„è¯­æ³•ç³–ï¼Œå‘ğŸ‘‡çœ‹:
ä¸‹é¢è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç­‰ä»·çš„:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#007020;font-weight:700>async</span> <span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>return</span> <span style=color:#40a070>42</span>;
}

<span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>return</span> <span style=color:#007020;font-weight:700>new</span> <span style=color:#007020>Promise</span>((resolve, reject) =&gt; {
        resolve(<span style=color:#40a070>42</span>);
    });
}
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>async</code> å‡½æ•°é‡Œé¢æŠ›çš„é”™è¯¯ï¼Œä¼šå‡ºç°åœ¨ <code>rejected promise</code> ä¸­:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#007020;font-weight:700>async</span> <span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>throw</span> <span style=color:#007020;font-weight:700>new</span> <span style=color:#007020>Error</span>(<span style=color:#4070a0>&#39;oops!&#39;</span>);
}

<span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>return</span> <span style=color:#007020;font-weight:700>new</span> <span style=color:#007020>Promise</span>((resolve, reject) =&gt; {
        reject(<span style=color:#007020;font-weight:700>new</span> <span style=color:#007020>Error</span>(<span style=color:#4070a0>&#39;oops!&#39;</span>));
    });
}
</code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œåœ¨ <code>async</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>await</code> å…³é”®å­—å»ç­‰å¾…å¦ä¸€ä¸ª <code>promised</code> å‡½æ•°è¿”å›ï¼Œç„¶åæŠŠç»“æœèµ‹ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#007020;font-weight:700>async</span> <span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>const</span> userId <span style=color:#666>=</span> <span style=color:#40a070>42</span>;
    <span style=color:#007020;font-weight:700>const</span> user <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>await</span> User.findById(userId);

    <span style=color:#007020;font-weight:700>return</span> user.name;
}

<span style=color:#007020;font-weight:700>function</span> foo() {
    <span style=color:#007020;font-weight:700>const</span> userId <span style=color:#666>=</span> <span style=color:#40a070>42</span>;

    <span style=color:#007020;font-weight:700>return</span> User.findById(userId).then(user =&gt; {
        <span style=color:#007020;font-weight:700>return</span> user.name;
    });
}
</code></pre></td></tr></table>
</div>
</div><h2 id=å‚è€ƒ>å‚è€ƒ <a href=#%e5%8f%82%e8%80%83 class=anchor>Â¶</a></h2>
<p><a href=https://www.tutorialspoint.com/koajs/index.htm target=_blank rel=noopener>tutorial spoint</a>
<a href=https://github.com/koajs/examples target=_blank rel=noopener>koajs/examples</a>
</p>
</section>
<section class=related>
<h3>Related</h3>
<ul>
<li><a href=/posts/2019/05/nodejs-learn-note/>Nodejsä¹‹nextTick vs setImmediate</a></li>
<li><a href=/posts/2019/05/linux-command/>Linuxå¸¸ç”¨å‘½ä»¤</a></li>
<li><a href=/posts/2019/05/setup-your-own-git-server/>æ­å»ºè‡ªå·±çš„gitæœåŠ¡å™¨</a></li>
<li><a href=/about/></a></li>
</ul>
</section>
<div class=bottom-nav>
<a href=/posts/2019/05/linux-command/>&lt; Linuxå¸¸ç”¨å‘½ä»¤</a>
<a href=/posts/2019/05/koa-scaffold/>Koa é¡¹ç›®è„šæ‰‹æ¶ ></a>
</div>
<section class=comments>
<h3>Comments</h3>
</section>
</article>
</main>
</div>
</body>
</html>